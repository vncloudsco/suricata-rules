# Note1: Please, set $DC_SERVERS address group in suricata.yaml config, so Active Directory rules could work properly.
# 
# Note2: Rules for detection malicious TLS connections require full stream inspection.
# Please, uncomment app-layer.protocols.tls.encryption-handling option in suricata.yaml file and set it to 'full' as shown here:
# app-layer:
#   protocols:
#     tls:
#       enabled: yes
#       encryption-handling: full

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Attempt to crash named using malformed RNDC packet"; flow: established, to_server; content:"_auth"; depth: 20; fast_pattern; content: !"|02 00 00 00|"; within: 4; content: "_ctrl"; content: "_ser"; content: "_tim"; content: "_exp"; reference: cve, 2016-1285; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000005; rev: 3; )

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Attempt to crash named using malformed RNDC packet"; flow: established, to_server; content:"_auth"; depth: 20; fast_pattern; content: !"|01 00 00 00|"; distance: 10; within: 4; content: "_ctrl"; content: "_ser"; content: "_tim"; content: "_exp"; reference: cve, 2016-1285; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000006; rev: 3; )

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] SSLv2 Hello flood. Possible DROWN attack"; flow: established,to_server; ssl_version: sslv2; ssl_state: client_hello; content: "|01 00 02|"; offset: 2; depth: 3; threshold: type both, track by_src, count 30, seconds 10; reference: url, drownattack.com; reference: cve, 2016-0800; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10000010; rev:1;)

alert http $HOME_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Mismatch URI and Host header. Possible Squid cache poisoning"; content: "GET"; http_method; content: "://"; fast_pattern; distance: 0; http_raw_uri; pcre: "/^\w+\s+\w+:\/\/\S+\s+.*?[\r\n].*?Host:[ \t]+[\w\.:]+\b/is"; pcre:! "/^\w+\s+\w+:\/\/([^\/\s:#]+)[\/\s:#]\S*.+?Host:[ \t]*\1\S*\b/is"; reference: url, bugs.squid-cache.org/show_bug.cgi?id=4501; reference: cve, 2016-4554; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10000035; rev: 4; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] PHP7 x86 heap overflow attempt via crafted zip archive"; flow: established, to_server; content: "POST"; http_method; content:"PK|01 02|"; fast_pattern; content: "|FF FF FF|"; distance: 21; within: 3; content:"PK|01 02|"; distance: 0; content: "|FF FF FF|"; distance: 21; within: 3; content:"PK|01 02|"; distance: 0; content: "|FF FF FF|"; distance: 21; within: 3; content:"PK|01 02|"; distance: 0; content: "|FF FF FF|"; distance: 21; within: 3; reference: cve, 2016-3078; reference: url, github.com/dyntopia/exploits/blob/master/CVE-2016-3078; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000037; rev: 1; )

alert udp $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Nfcapd buffer overflow via incorrect flowset_length field attempt"; content:"|00 0a|"; depth: 2; content: "|00 02 00|"; distance: 14; within: 3; byte_test: 1, <=, 0x07, 0, relative; byte_test: 1, >=, 0x05, 0, relative; reference: url, www.exploit-db.com/exploits/39800; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000038; rev: 1; )

alert udp $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Nfcapd buffer overflow with large scope_field_count field attempt"; content:"|00 0a|"; depth: 2; content: "|00 03 00|"; distance: 14; within: 3; content: "|00 00|"; distance: 3; within: 2; byte_test: 2, >=, 30000, 0, relative; reference: url, www.exploit-db.com/exploits/39800; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000039; rev: 1; )

alert udp $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Nfcapd DoS attempt caused inifinite loop"; content:"|00 09|"; depth: 2; content: "|00 00 00 14 04 00 00|"; distance: 18; within: 7; reference: url, www.exploit-db.com/exploits/39800; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000040; rev: 1; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Magento < 2.0.6 Arbitrary write file"; content: "rest/V1/guest-carts/"; http_raw_uri; content: "set-payment-information"; http_raw_uri; fast_pattern; content: "|5C 75 30 30 30 30|"; content: "Magento\\\\Sales\\\\Model\\\\Order\\\\Payment\\\\Transaction"; reference: cve, 2016-4010; reference: url, netanelrub.in/2016/05/17/magento-unauthenticated-remote-code-execution; classtype: web-application-attack; reference: url, github.com/ptresearch/AttackDetection; sid: 10000042; rev: 1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ATTACK [PTsecurity] GraphicsMagick popen shell vulnerability"; flow:established,to_server; content:"<?xml"; http_client_body; content:"<svg"; http_client_body; fast_pattern; pcre:"/xlink:href\s*=\s*\x22\|/RPi"; reference: url, permalink.gmane.org/gmane.comp.security.oss.general/19669; classtype:web-application-attack; reference: url, github.com/ptresearch/AttackDetection; sid: 10000044; rev:1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ATTACK [PTsecurity] GraphicsMagick popen shell vulnerability"; flow:established,to_server; content:"viewbox "; nocase; http_client_body; fast_pattern; pcre:"/image\s+copy\s+\d+\s*,\s*\d+\s+\d+\s*,\s*\d+\s*\x22\|/RPi"; reference: url, permalink.gmane.org/gmane.comp.security.oss.general/19669; classtype:web-application-attack; reference: url, github.com/ptresearch/AttackDetection; sid: 10000045; rev:1;)

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Apache Continuum <= v1.4.2 CMD Injection"; content: "POST"; http_method; content: "/continuum/saveInstallation.action"; offset: 0; depth: 34; http_uri; content: "installation.varValue="; nocase; http_client_body; pcre: !"/^\$?[\sa-z\\_0-9.-]*(\&|$)/iRP"; flow: to_server, established; classtype: web-application-attack; reference: url, exploit-db.com/exploits/39886; reference: url, github.com/ptresearch/AttackDetection; sid: 10000048; rev: 1;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Apache Struts 2.3.20-2.3.28.1 Privilege Escalation attempt"; content: "#_memberAccess"; http_uri; content: "="; http_uri; distance: 0; content: "@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS"; http_uri; distance: 0; reference: cve, 2016-0785; reference: cve, 2016-3081; reference: cve, 2016-3087; reference: cve, 2016-3093; reference: cve, 2016-4438; reference: url, struts.apache.org/docs/s2-029.html; reference: url, struts.apache.org/docs/s2-032.html; reference: url, struts.apache.org/docs/s2-033.html; reference: url, struts.apache.org/docs/s2-034.html; reference: url, struts.apache.org/docs/s2-037.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000049; rev: 1;)

alert udp $EXTERNAL_NET 137 -> $HOME_NET 137 (msg: "ATTACK [PTsecurity] BadTunnel NBNS response after NBSTAT query"; flow: no_stream; byte_test: 1,&,0x80,2; content: !"|00 00|"; offset: 6; depth: 2; threshold: type limit, track by_dst, count 1, seconds 30; xbits:isset,BadTunnelStage1,track ip_dst; reference: url, xlab.tencent.com/en/2016/06/17/BadTunnel-A-New-Hope/; reference: cve, 2016-3236; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10000051; rev:2;)

#alert udp $EXTERNAL_NET 137 -> $HOME_NET 137 (msg: "ATTACK [PTsecurity] BadTunnel WPAD spoofing attempt via NBNS"; flow: no_stream; content: "|46 48 46 41 45 42 45 45|"; offset: 13; depth: 8; threshold: type limit, track by_dst, count 1, seconds 30; reference: url, xlab.tencent.com/en/2016/06/17/BadTunnel-A-New-Hope/; reference: cve, 2016-3236; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10000052; rev:1;)

#alert udp $EXTERNAL_NET 137 -> $HOME_NET 137 (msg: "ATTACK [PTsecurity] BadTunnel ISATAP spoofing attempt via NBNS"; flow: no_stream; content: "|45 4A 46 44 45 42 46 45 45 42 46 41|"; offset: 13; depth: 12; threshold: type limit, track by_dst, count 1, seconds 30; reference: url, xlab.tencent.com/en/2016/06/17/BadTunnel-A-New-Hope/; reference: cve, 2016-3236; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10000053; rev:1;)

#alert ip $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] RCE attempt via malformed ASPack"; content: "M"; offset: 0; depth: 2; content: "Z"; distance: -2; within: 3; content: "PE"; offset: 64; depth: 2; byte_test: 4, >, 0, 70, little; byte_extract: 4, 144, cve20162208, little; byte_test: 4, >, cve20162208, 328, little; reference: cve, 2016-2208; reference: url, bugs.chromium.org/p/project-zero/issues/detail?id=820; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000057; rev: 1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "ATTACK [PTsecurity] GNU Wget http request"; content: "wget"; http_user_agent; nocase; depth: 4; flowbits: set, 10000062; flowbits: noalert; reference: cve, 2016-4971; classtype:bad-unknown; reference: url, legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt; reference: url, github.com/ptresearch/AttackDetection; sid: 10000062; rev: 2; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] GNU Wget < 1.18 Arbitrary File Upload / Potential Remote Code Execution"; flowbits: isset, 10000062; content: "30"; http_stat_code; depth: 2; content: "Location: ftp://"; nocase; http_header; reference: cve, 2016-4971; classtype:bad-unknown; reference: url, legalhackers.com/advisories/Wget-Arbitrary-File-Upload-Vulnerability-Exploit.txt; reference: url, github.com/ptresearch/AttackDetection; sid: 10000063; rev: 2; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Possible HTTPoxy HTTP_PROXY value spoofing"; flow: established, to_server; content: "|0A|Proxy:"; nocase; http_header; reference: url, httpoxy.org; reference: cve, 2016-5385; reference: cve, 2016-5386; reference: cve, 2016-5387; reference: cve, 2016-5388; reference: cve, 2016-1000109; reference: cve, 2016-1000110; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10000065; rev: 3;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ATTACK [PTsecurity] FreePBX 13/14 Malicious Filename Upload attempt"; flow: to_server; content: "POST"; http_method; nocase; content:"/admin/ajax.php?"; http_uri; content:"module=recordings"; http_uri; content:"command=savebrowserrecording"; http_uri; content: "Content-Type: multipart/form-data"; nocase; http_header; pcre:"/Content-Disposition: form-data\; name=\x22filename\x22\r\n\r\n[^\r\n]*\x60[^\r\n]*\x60.*\r\n/P"; xbits: set, FreePBXMaliciousFilenameUpload, track ip_dst, expire 30; classtype: attempted-user; reference: exploitdb, 40232; reference: url, github.com/ptresearch/AttackDetection; sid:10000082; rev:2;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ATTACK [PTsecurity] FreePBX 13/14 Remote Command Execution"; flow: to_server; content: "POST"; http_method; nocase; content:"/admin/ajax.php"; http_uri; content: "Content-Type: application/x-www-form-urlencoded"; nocase; http_header; pcre:"/file=[^&]*\x60[^&]*\x60/P"; pcre:"/module=recordings/P"; xbits: isset, FreePBXMaliciousFilenameUpload, track ip_dst; classtype: successful-user; reference: exploitdb, 40232; reference: url, github.com/ptresearch/AttackDetection; sid:10000083; rev:2;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"ATTACK [PTsecurity] FreePBX 13/14 Remote Command Execution attempt"; flow: to_server; content:"POST"; http_method; content:"/admin/ajax.php"; http_uri; content:"Content-Type: application/x-www-form-urlencoded"; nocase; http_header; pcre:"/file=[^&]*\x60[^&]*\x60/P"; pcre:"/module=recordings/P"; xbits: isnotset, FreePBXMaliciousFilenameUpload, track ip_dst; classtype: attempted-user; reference: exploitdb, 40232; reference: url, github.com/ptresearch/AttackDetection; sid:10000084; rev:2;)

alert udp any any -> $HOME_NET 161 (msg: "ATTACK [PTsecurity] Cisco Adaptive Security Appliance 8.x SNMP overflow RCE Probe"; content: "|a035020100020100020100302a300c06082b060102010101000500300c06082b060102010103000500300c06082b060102010105000500|"; isdataat:!1, relative; reference: url, blogs.cisco.com/security/shadow-brokers; reference: cve, 2016-6366; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10000098; rev: 2; )

alert udp any any -> $HOME_NET 161 (msg: "ATTACK [PTsecurity] Cisco Adaptive Security Appliance 8.x SNMP overflow RCE Attempt"; byte_jump:1, 6; content: "|A5|"; content: "|2B 06 01 02 01 01 01|"; distance: 0; content: "|2B 06 01 04 01 09 09 83 6B 01 03 03 01 01 05 09|"; isdataat:30,relative; reference: url, blogs.cisco.com/security/shadow-brokers; reference: cve, 2016-6366; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000099; rev: 2; )

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] EpicBanana Exploitation"; content: "|50 16 60 16 b8 16 82 16 aa 16 aa 16 aa 16 35 16 aa 16 aa 16 aa 16 aa|"; depth: 24; classtype: attempted-admin; reference: url, tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20160817-asa-cli; reference: cve, 2016-6367; reference: url, github.com/ptresearch/AttackDetection; sid:10000125; rev:1;)

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] MySQL <= 5.7.15, 5.6.33, 5.5.53 root RCE/Privilege Escalation attempt"; content:"|03|"; offset:4; depth:1; content:"736574"; distance:0; content:"6c6f675f66696c65"; distance:0; content:"6d79"; distance:0; content:"2e636e66"; distance:0; within:14; reference: url, legalhackers.com/advisories/MySQL-Exploit-Remote-Root-Code-Execution-Privesc-CVE-2016-6662.html; reference: cve, 2016-6662; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid:10000128; rev:1;)

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] MySQL <= 5.7.15, 5.6.33, 5.5.53 root RCE/Privilege Escalation attempt"; content:"|03|"; offset:4; depth:1; content:"set"; distance:0; content:"log_file"; distance:0; content:"my"; distance:0; content:".cnf"; distance:0; within:7; reference: url, legalhackers.com/advisories/MySQL-Exploit-Remote-Root-Code-Execution-Privesc-CVE-2016-6662.html; reference: cve, 2016-6662; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid:10000129; rev:1;)

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Likely OpenSSL TLS renegotiations DoS"; flow: to_server, no_stream; content: "|16|"; depth: 1; flowint: tlshandshakecount, +, 1; flowbits: noalert; reference: url, security.360.cn/cve/CVE-2016-6304/; reference: cve, 2016-6304; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000131; rev: 3; )

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Apple macOS 10.12.1/iOS 10 OCSP DDoS Attempt (CVE-2016-7636)"; flow: established, from_server, only_stream; content: "|16 03|"; depth: 2; content: "|16 03|"; content: "|0B|"; distance: 3; within: 1; content: "|30 83|"; content: "|30|"; distance: 3; within: 1; content: "|06 08 2B 06 01 05 05 07 30 02 86|"; distance: 1; within: 11; byte_jump: 1, 0, relative; content: "|30|"; content: "|06 08 2B 06 01 05 05 07 30 02 86|"; distance: 1; within: 11; byte_jump: 1, 0, relative; content: "|30|"; pcre: "/(?:[^\x06]+\x06\x08\x2B\x06\x01\x05\x05\x07\x30\x02\x86){10,}/"; reference: cve, 2016-7636; reference: url, cxsecurity.com/issue/WLB-2016100213; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000495; rev: 1; )

alert tcp any any -> any 445 (msg: "ATTACK [PTsecurity] LSASS Remote Memory Corruption Attempt (MS16-137)"; flow: established, no_stream; content: "|FF|SMB|73 00 00 00 00|"; offset: 4; depth: 9; content: "|FF 00|"; offset: 37; depth: 2; content: "|01 00 00 00 00 00|"; offset: 45; depth: 6; content: "|00 00 00 00 D4 00 00 A0|"; distance: 2; within: 8; content: "|A1 84|"; distance: 2; within: 2; byte_test:1,!=,0xD1,0,relative; flowbits: set, CVE.2016-7237.Attempt; xbits:set,CVE.2016-7237.Attempt,track ip_dst,expire 15; reference: cve, 2016-7237; reference: url, g-laurent.blogspot.ru/2016/11/ms16-137-lsass-remote-memory-corruption.html; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000532; rev: 2; )

alert tcp any 445 -> any any (msg: "ATTACK [PTsecurity] LSASS Remote Memory Corruption Successful LSASS Inf. loop (MS16-137)"; flow: established, no_stream; content: "|FF|SMB|73 05 02 00 C0|"; offset: 4; depth: 9; flowbits: isset, CVE.2016-7237.Attempt; reference: cve, 2016-7237; reference: url, g-laurent.blogspot.ru/2016/11/ms16-137-lsass-remote-memory-corruption.html; classtype: successful-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000533; rev: 2;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Omnivista 8770 UnAuth RCE (AddJobSet)"; flow: established, no_stream; content: "GIOP"; depth: 4; content: "SchedulerInterface"; distance: 0; content: "AddJobSet"; distance: 0; flowbits: set, Omnivista.SchedulerInterface.AddJobSet; flowbits: noalert; reference: url, blog.malerisch.net/2016/12/alcatel-omnivista-8770-unauth-rce-giop-corba.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000677; rev: 1; )

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Omnivista 8770 UnAuth RCE (AddJob)"; flow: established, no_stream; content: "GIOP"; depth: 4; byte_jump:4,24; content: "|00 00 00 07|AddJob|00|"; within: 11; flowbits: isset, Omnivista.SchedulerInterface.AddJobSet; flowbits: set, Omnivista.SchedulerInterface.AddJob; flowbits: noalert; reference: url, blog.malerisch.net/2016/12/alcatel-omnivista-8770-unauth-rce-giop-corba.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000678; rev: 1; )

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Omnivista 8770 UnAuth RCE (ExecuteNow)"; flow: established, no_stream; content: "GIOP"; depth: 4; byte_jump:4,24; content: "|00 00 00 0B|ExecuteNow|00|"; within: 15; flowbits: isset, Omnivista.SchedulerInterface.AddJob; reference: url, blog.malerisch.net/2016/12/alcatel-omnivista-8770-unauth-rce-giop-corba.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000679; rev: 1; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] iOS 10.1.x Remote memory corruption through certificate file Attempt"; flow: established, from_server; content: "-----BEGIN CERTIFICATE-----"; depth: 27; http_server_body; content: "BggrBgEFBQcwAoaD"; distance: 0; http_server_body; reference: url, cxsecurity.com/issue/WLB-2016110046; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000757; rev: 1; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] iOS 10.1.x Remote memory corruption through certificate file Attempt"; flow: established, from_server; content: "-----BEGIN CERTIFICATE-----"; depth: 27; http_server_body; content: "YIKwYBBQUHMAKGgw"; distance: 0; http_server_body; reference: url, cxsecurity.com/issue/WLB-2016110046; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000758; rev: 1; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] iOS 10.1.x Remote memory corruption through certificate file Attempt"; flow: established, from_server; content: "-----BEGIN CERTIFICATE-----"; depth: 27; http_server_body; content: "GCCsGAQUFBzAChoM"; distance: 0; http_server_body; reference: url, cxsecurity.com/issue/WLB-2016110046; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000759; rev: 1; )

alert http $HOME_NET any -> any any (msg: "ATTACK [PTsecurity] Nagios Core < 4.2.2 Curl Command Injection (CVE-2016-9565) RSS Request"; flow:established, to_server; content: "/nagios/rss-"; http_uri; content: ".php"; http_uri; distance: 0; content: "User-Agent: magpie"; http_header; nocase; flowbits: set, CVE.2016-9565.RSSRequest; reference: url, legalhackers.com/advisories/Nagios-Exploit-Command-Injection-CVE-2016-9565-2008-4796.html; reference: cve, 2016-9565; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000777; rev: 1; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Nagios Core < 4.2.2 Curl Command Injection (CVE-2016-9565) Attempt"; flow:established, from_server; content: "302"; http_stat_code; content: "nagios"; http_header; flowbits: isset, CVE.2016-9565.RSSRequest; reference: url, legalhackers.com/advisories/Nagios-Exploit-Command-Injection-CVE-2016-9565-2008-4796.html; reference: cve, 2016-9565; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000778; rev: 1; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Nagios Core < 4.2.2 Curl Command Injection (CVE-2016-9565) Remote Script Execution"; flow:established, from_server; content: "302"; http_stat_code; content: "--trace-ascii"; http_header; content: " -F"; http_header; pcre: "/Location\:(?:.*?\s+-F\S+\s+){2}/Hi"; flowbits: isset, CVE.2016-9565.RSSRequest; reference: url, legalhackers.com/advisories/Nagios-Exploit-Command-Injection-CVE-2016-9565-2008-4796.html; reference: cve, 2016-9565; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10000779; rev: 1; )

alert dns any any -> $HOME_NET any (msg: "INFO [PTsecurity] DNS RRSIG without covered RR (CVE-2016-9147)"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 6; content: "|00 00|"; distance: 0; content: "|00 01|"; distance: 1; within: 2; content: "|00 2E 00|"; fast_pattern; distance: 0; pcre: "/.{4,6}\x00\x01\x00\x01.{4}[^\x00]+\x00.{4}[^\x00]+\x00(?:\x2e|\x00\x2e)/"; reference: cve, 2016-9147; reference: url, kb.isc.org/article/AA-01440/74/CVE-2016-9147%3A-An-error-handling-a-query-response-containing-inconsistent-DNSSEC-information-could-cause-an-assertion-failure-.html; classtype: attempted-dos; reference: url, github.com/ptresearch/AttackDetection; sid: 10000892; rev: 2; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] Apache Struts < 2.3.32 < 2.5.10.1 RCE through Jakarta Multipart parser Attempt"; flow: established, to_server; content: "%{"; fast_pattern; http_header; content: "multipart/form-data"; http_header; content: "#_memberAccess"; http_header; content: "@java"; http_header; reference: cve, 2017-5638; reference: url, paper.seebug.org/241/; classtype:attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001065; rev: 3;)

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Buffer Overflow via Negative HTTP Chunk size number (FFMPEG CVE-2016-10190, WGET CVE-2017-13089, CVE-2017-13090)"; flow: established, from_server; content: "Transfer-Encoding"; nocase; http_header; content: "chunked"; http_header; nocase; distance: 0; app-layer-event:http.invalid_response_chunk_len; pcre: "/^\s*-[0-9A-Fa-f]+/Qs"; reference: cve, 2016-10190; reference: cve, 2017-13089; reference: cve, 2017-13090; reference: url, trac.ffmpeg.org/ticket/5992; reference: url, bugzilla.redhat.com/show_bug.cgi?id=CVE-2017-13089; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001108; rev: 2; )

alert http any any -> $HOME_NET any (msg:"ATTACK [PTsecurity] MS IIS 6.0 BO RCE (CVE-2017-7269)"; flow: to_server, established; content: "PROPFIND"; http_method; content: "If: <"; http_header; nocase;  pcre: "/^If: <[^\r\n>]+[\x7F-\xFF]/Hmi"; reference:url, www.helpnetsecurity.com/2017/03/30/cve-2017-7269/; reference: cve, 2017-7269; classtype:attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001195; rev: 1;)

alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Unimplemented Trans2 Sub-Command code. Possible ETERNALBLUE (WannaCry, Petya) tool"; flow: to_server, established; content: "|FF|SMB2|00 00 00 00|"; depth: 9; offset: 4; byte_test: 2, >, 0x0008, 52, relative, little; pcre: "/\xFFSMB2\x00\x00\x00\x00.{52}(?:\x04|\x09|\x0A|\x0B|\x0C|\x0E|\x11)\x00/s"; flowbits: set, SMB.Trans2.SubCommand.Unimplemented; reference: url, msdn.microsoft.com/en-us/library/ee441654.aspx; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001254; rev: 2;)

#alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] ETERNALBLUE (WannaCry, Petya) SMB MS Windows RCE"; flow: to_server, established; content: "|FF|SMB3|00 00 00 00|"; depth: 9; offset: 4; flowbits: isset, SMB.Trans2.SubCommand.Unimplemented; threshold: type limit, track by_src, seconds 60, count 1; reference: cve, 2017-0144; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001255; rev: 3;)

#alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Trans2 Sub-Command 0x0E. Likely ETERNALBLUE (WannaCry, Petya) tool"; flow: to_server, established; content: "|FF|SMB2|00 00 00 00|"; depth: 9; offset: 4; content: "|0E 00|"; distance: 52; within: 2; flowbits: set, SMB.Trans2.SubCommand.Unimplemented.Code0E; reference: url, msdn.microsoft.com/en-us/library/ee441654.aspx; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001256; rev: 2;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Safari 10.0.3 UAF RCE (CVE-2017-2491)"; flow: established, from_server; file_data; content: "RegExp"; content: ".repeat"; within: 25; content: ".repeat"; within: 50; content: ".repeat"; within: 50; content: "ArrayBuffer"; within: 100; content: "Uint8Array"; within: 50; content: "Float64Array"; within: 50; content: "jsCellHeader"; distance: 0; content: "butterfly"; distance: 0; reference: cve, 2017-2491; reference: url, github.com/phoenhex/files/blob/master/exploits/cachedcall-uaf.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001322; rev: 2; )

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Safari 10.0.3 UAF RCE (CVE-2017-2491)"; flow: established, from_server; file_data; content: "0x40000"; content: "0x1000"; content: "0x10000000"; content: "0x7ffff000"; content: "0x80"; content: "0x81"; content: "0x50"; reference: cve, 2017-2491; reference: url, github.com/phoenhex/files/blob/master/exploits/cachedcall-uaf.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001326; rev: 1; )

alert smb any any -> $HOME_NET any (msg:"ATTACK [PTsecurity] Samba RCE exploitation attempt (SambaCry)"; flow: to_server, established, no_stream; content: "|ff 53 4d 42 a2|"; offset: 4; depth: 5; byte_extract: 2, 85, name_length, little; content: "|2f|"; distance: 2; within:name_length; content: !"|04|"; distance: 0; within: 1; reference: cve, 2017-7494; reference: url, www.samba.org/samba/security/CVE-2017-7494.html; reference: url, thehackernews.com/2017/05/samba-rce-exploit.html; classtype: attempted-user; reference: url, github.com/ptresearch/AttackDetection; sid: 10001356; rev: 5;)

alert smb any any -> $HOME_NET any (msg:"ATTACK [PTsecurity] Samba RCE exploitation attempt (SambaCry)"; flow: to_server, established, no_stream; content: "|fe 53 4d 42|"; offset: 4; depth: 4; content: "|05 00|"; offset: 16; depth: 2; fast_pattern; byte_extract: 2, 114, name_length, little; byte_jump: 2, 112, little, from_beginning, post_offset 4; content: "|2f|"; distance:0; within:name_length; content: !"|04|"; distance:0; within: 1; reference: cve, 2017-7494; reference: url, www.samba.org/samba/security/CVE-2017-7494.html; reference: url, thehackernews.com/2017/05/samba-rce-exploit.html; classtype: attempted-user; reference: url, github.com/ptresearch/AttackDetection; sid: 10001357; rev: 5;)

alert smb any any -> $HOME_NET any (msg:"ATTACK [PTsecurity] Samba RCE exploitation attempt (SambaCry)"; flow: to_server, established, no_stream; content: "|ff 53 4d 42 2d|"; offset: 4; depth: 5; byte_extract: 2, 67, name_length, little; content: "|2f|"; distance: 2; within:name_length; content: !"|04|"; distance: 0; within: 1; reference: cve, 2017-7494; reference: url, www.samba.org/samba/security/CVE-2017-7494.html; reference: url, thehackernews.com/2017/05/samba-rce-exploit.html; classtype: attempted-user; reference: url, github.com/ptresearch/AttackDetection; sid: 10001438; rev: 1;)

alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Petya ransomware perfc.dat component"; flow: to_server, established, no_stream; content: "|fe 53 4d 42|"; offset: 4; depth: 4; content: "|05 00|"; offset: 16; depth: 2; byte_jump: 2, 112, little, from_beginning, post_offset 4; content: "|70 00 65 00 72 00 66 00 63 00 2e 00 64 00 61 00 74 00|"; distance:0; classtype:suspicious-filename-detect; reference: url, github.com/ptresearch/AttackDetection; sid: 10001443; rev: 1;)

alert smb any any -> $HOME_NET any (msg:"ATTACK [PTsecurity] SMB2 Create PSEXESVC.EXE"; flow:to_server, established, no_stream; content: "|fe 53 4d 42|"; offset: 4; depth: 4; content: "|05 00|"; offset: 16; depth: 2; byte_jump: 2, 112, little, from_beginning, post_offset 4; content:"|50 00 53 00 45 00 58 00 45 00 53 00 56 00 43 00 2e 00 45 00 58 00 45|"; distance:0; classtype:suspicious-filename-detect; reference: url, github.com/ptresearch/AttackDetection; sid: 10001444; rev:1;)

alert dns any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] ISC BIND DNS TSIG authentication bypass attempt (CVE-2017-3143, HMAC_SHA256)"; flow: to_server; content: "|00 FA|"; content: "|00 00 00 00|"; distance: 2; within: 4; content: "|0B|hmac-sha256|00|"; within: 15; byte_test: 2, >, 32, 8, relative; flowbits: set, CVE.2017-3143.attempt; reference: cve, 2017-3143; reference: url, http://www.synacktiv.ninja/ressources/CVE-2017-3143_BIND9_TSIG_dynamic_updates_vulnerability_Synacktiv.pdf; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001502; rev: 1; )

alert dns any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] ISC BIND DNS TSIG authentication bypass successful (CVE-2017-3143)"; flow: from_server; content: "|00 FA|"; content: "|00 00 00 00|"; distance: 2; within: 4; content: "|0B|hmac-sha256|00|"; within: 15; byte_test: 2, >, 0, 8, relative; flowbits: isset,CVE.2017-3143.attempt; flowbits: unset,CVE.2017-3143.attempt; reference: cve, 2017-3143; reference: url, http://www.synacktiv.ninja/ressources/CVE-2017-3143_BIND9_TSIG_dynamic_updates_vulnerability_Synacktiv.pdf; classtype: successful-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001508; rev: 2; )

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL connection #0.1"; flow: established, to_server; content: "|17 03 01 00 80|"; depth:5; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert;flowbits: set, FB313831_0; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 10001683; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL connection #0.2"; flow: established, to_server; content: "|17 03 01 00 90|"; depth:5; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert;flowbits: set, FB313831_0; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 10001684; rev: 1;) 

alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL connection #1"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,2512, 1, relative; byte_test: 2, <=,7900, 1, relative; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert; flowbits: isset, FB313831_0; flowbits: unset, FB313831_0; flowbits: set, FB313831_1; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 10001685; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL connection #2.1"; flow: established, to_client; content: "|17 03 01 01 60|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 10001686; rev: 1;) 

alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Metasploit MS17-010 ETERNALCHAMPION. Non-Fragmented NT Trans Request with command NT Rename (CVE-2017-0146)"; flow: established, to_server; content: "|FF|SMB|A0|"; offset: 4; depth: 5; byte_extract: 4, 35, NTTrans.TotalDataCount, relative, little; byte_test: 4, =, NTTrans.TotalDataCount, 16, relative, little; content: "|05 00|"; distance: 25; within: 2; isdataat:300, relative; flowbits: set, EternalRomance.RaceCondition.Possible; flowbits: noalert; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001717; rev: 2;)

alert smb $HOME_NET any -> any any (msg: "ATTACK [PTsecurity] NT Trans Response"; flow: established, from_server; content: "|FF|SMB|A0|"; offset: 4; depth: 5; flowbits: isset, EternalRomance.RaceCondition.Possible; flowbits: unset, EternalRomance.RaceCondition.Possible; flowbits: noalert; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001718; rev: 1;)

alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Metasploit MS17-010 ETERNALCHAMPION Race Condition Exploit. NT Trans Secondary packet follows NT Trans Req (CVE-2017-0146)"; flow: established, no_stream, to_server; content: "|FF|SMB|A1|"; flowbits: isset, EternalRomance.RaceCondition.Possible; flowbits: set, EternalRomance.RaceCondition.Attempt; threshold: type both, track by_src, count 1, seconds 60; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001719; rev: 1;)

alert smb $HOME_NET any -> any any (msg: "ATTACK [PTsecurity] Metasploit MS17-010 ETERNALCHAMPION Successful kernel data leak (CVE-2017-0146)"; flow: established, from_server; content: "|FF|SMB|A0|"; content: "Frag"; within: 115; flowbits: isset, EternalRomance.RaceCondition.Attempt; reference: cve, 2017-0146; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, blogs.technet.microsoft.com/srd/2017/06/29/eternal-champion-exploit-analysis; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001720; rev: 1;)

alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Metasploit MS17-010 ETERNALROMANCE exploitation (CVE-2017-0143)"; flow: established, to_server; content: "|FF|SMB|A1|"; content: "|FF|SMB|A0|"; distance: 0; content: "|05 00|"; distance: 64; within: 2; content: "|FF|SMB|25|"; distance: 13; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5;  content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; content: "|FF|SMB|25|"; distance: 67; within: 5; threshold: type both, track by_src, count 1, seconds 60; reference: cve, 2017-0143; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; reference: url, www.crowdstrike.com/blog/badrabbit-ms17-010-exploitation-part-one-leak-and-control; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001723; rev: 1; )

alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Flowbits for SMB NTTrans Request"; flow: established, to_server, no_stream; content: "|FF|SMB|A0|"; flowbits: set, SMB.NTTrans.Req; flowbits: unset, SMB.NTTrans2.Req; flowbits: noalert; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001724; rev: 1; )

alert smb any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Metasploit MS17-010 ETERNALBLUE Exploitation (CVE-2017-0144)"; flow: established, to_server, no_stream; content: "|FF|SMB|33|"; byte_test: 2, >, 61000, 42, relative, little; flowbits: isset, SMB.NTTrans.Req; flowbits: isnotset, SMB.NTTrans2.Req; reference: cve, 2017-0144; reference: url, github.com/rapid7/metasploit-framework/commit/c9473f8cbc147fe6ff7fe27862fd3d1e9f27c4f5; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001726; rev: 1; )

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] SVN/Git Remote Code Execution through malicious (svn+,git+)ssh:// URL (Multiple CVEs)"; flow: established; content: "ssh://-"; nocase; pcre: "/\S{3}/Rsi"; reference: cve, 2017-9800; reference: cve, 2017-12426; reference: cve, 2017-1000116; reference: cve, 2017-1000117; reference: url, subversion.apache.org/security/CVE-2017-9800-advisory.txt; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001756; rev: 3; )

alert tcp any [3690, 9418] <> any any (msg: "ATTACK [PTsecurity] SVN/Git Remote Code Execution through malicious (svn+,git+)ssh:// URL (Multiple CVEs)"; flow: established; content: "ssh://"; nocase; pcre: "/ssh:\/\/(?:[^@\s]+@)?(?:[\w\:\.\-\[\]\@]+[^\w\:\.\-\[\]\@\/\ ]|[^\w\:\.\-\[\]\@\/\ ][\w\:\.\-\[\]\@])/i"; reference: cve, 2017-9800; reference: cve, 2017-12426; reference: cve, 2017-1000116; reference: cve, 2017-1000117; reference: url, subversion.apache.org/security/CVE-2017-9800-advisory.txt; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001757; rev: 3; )

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trickbot/Dyre/Dridex #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,160, 1, relative; byte_test: 2, <=,240, 1, relative; stream_size: server, <,3000; stream_size: client, <,3000; flowbits: noalert; flowbits: set, FB320221_0; classtype: trojan-activity; metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 10001758; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trickbot/Dyre/Dridex #2";flow: established, to_client;content: "|17 03 01 00 F0|";depth:5;content: "|17 03 01  00 20|";distance:240;within:5;content: "|17 03 01|";distance:32;within:3;stream_size: server, <,30000;stream_size: client, <,30000;flowbits: isset, FB320221_0; flowbits: unset, FB320221_0; flowbits: set, FB320221_1; flowbits: noalert ; classtype: trojan-activity;metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 10001759; rev: 2;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trickbot/Dyre/Dridex #3";flow: established, to_client;content: "|17 03 01 01 00|"; depth:5; content: "|17 03 01  00 20|"; distance:256; within:5; content: "|17 03 01|";distance:32;within:3;stream_size: server, <,30000;stream_size: client, <,30000;flowbits: isset, FB320221_0; flowbits: unset, FB320221_0; flowbits: set, FB320221_1; classtype: trojan-activity;metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 10001760; rev: 1;) 

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] SVN/Git Remote Code Execution through malicious (svn+,git+)ssh:// URL (Multiple CVEs)"; flow: established, from_server; content: "30"; http_stat_code; depth: 2; content: "Location:"; http_header; nocase; content: "ssh://"; nocase; http_header; distance: 0; pcre: "/ssh:\/\/(?:[^@\s]+@)?(?:[\w\:\.\-\[\]\@]+[^\w\:\.\-\[\]\@\/\ ]|[^\w\:\.\-\[\]\@\/\ ][\w\:\.\-\[\]\@])/Hi"; reference: cve, 2017-9800; reference: cve, 2017-12426; reference: cve, 2017-1000116; reference: cve, 2017-1000117; reference: url, subversion.apache.org/security/CVE-2017-9800-advisory.txt; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001763; rev: 2; )

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL connection #2.2"; flow: established, to_client; content: "|17 03 01 00 D0|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 10001792; rev: 1;) 

alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL connection #2.3"; flow: established, to_client; content: "|17 03 01 00 C0|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 10001793; rev: 1;)

alert http $HOME_NET any -> any any (msg: "ATTACK [PTsecurity] Apache2 <2.2.34 <2.4.27 Optionsbleed (CVE-2017-9798) Leak"; flow: established, from_server; content: "Allow:"; nocase; http_header; pcre: "/Allow:(?: ,|[^\r\n]*(?:[^A-Za-z0-9,\s-_]|,,))/Hi"; threshold: type limit, track by_src, count 1, seconds 10; reference: cve, 2017-9798; reference: url, blog.fuzzing-project.org/60-Optionsbleed-HTTP-OPTIONS-method-can-leak-Apaches-server-memory.html; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10001947; rev: 3; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Apache2 <2.2.34 <2.4.27 Optionsbleed (CVE-2017-9798) Attempt"; flow: established, to_server; content: "OPTIONS"; http_method; threshold: type both, track by_src, count 20, seconds 30; reference: cve, 2017-9798; reference: url, blog.fuzzing-project.org/60-Optionsbleed-HTTP-OPTIONS-method-can-leak-Apaches-server-memory.html; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10001948; rev: 1; )

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Remote WMI Win32_Process create"; flow: established, to_server; content: "|05 00 00|"; depth: 3; content: "W|00|i|00|n|00|3|00|2|00|_|00|P|00|r|00|o|00|c|00|e|00|s|00|s|00 00 00|"; fast_pattern; content: "c|00|r|00|e|00|a|00|t|00|e|00|"; distance: 16; within: 12; nocase; flowbits: set, WMI.Win32_Process.Create; threshold: type limit, track by_src, count 1, seconds 10; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10001999; rev: 3; )

alert tcp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Suspicious Remote WMI Win32_Process create"; flow: established, to_server; content: "__PARAMETERS|00 00|"; content: "http://"; distance: 0; pcre: "/__PARAMETERS\x00\x00[^\x00]+?(?:cmd|powershell)[^\x00]+?http:\/\//"; flowbits: isset, WMI.Win32_Process.Create; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002000; rev: 2; )

alert tcp $HOME_NET any -> $DC_SERVERS 88 (msg: "ATTACK [PTsecurity] Overpass the hash. Encryption downgrade activity to ARCFOUR-HMAC-MD5"; flow: no_stream, established, to_server; content: "|A1 03 02 01 05 A2 03 02 01 0A|"; offset: 12; depth: 10; content: "|A1 03 02 01 02|"; distance: 5; within: 6; content: "|A0 03 02 01 17|"; distance: 6; within: 6; content: "krbtgt"; distance: 0;  xbits: set, Krb5.AsReq, track ip_src, expire: 10; classtype: attempted-user; reference: url, github.com/ptresearch/AttackDetection; sid: 10002228; rev: 1; )

alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] PowerShell Empire Request HTTP Pattern";flow: established, to_server; content: "POST"; http_method; content: "HTTP/1.1|0d0a|Cookie: session="; depth:1000; fast_pattern; content: "=|0d0a|User-Agent: "; distance:27; within:400; content: "Host: "; within:400; content: "Content-Length: 462|0d0a|"; within: 400; content:!"Referer|3a|"; http_header; content: !"Content-Type: "; http_header; classtype: trojan-activity; metadata: created_at 2017_11_21; reference: url, github.com/ptresearch/AttackDetection; sid: 10002268; rev: 2;)

alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] PowerShell Empire stager receive over HTTP";flow: established, to_client; content:"200"; http_stat_code; content: "If($PSVersionTable.PSVersion.Major -ge 3){"; http_server_body; nocase; depth: 1000; content: "$GPS=[ref].Assembly.GetType(";http_server_body; nocase; within: 100; content: "System.Management.Automation.Utils";http_server_body; within: 100; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_11_22; reference: url, github.com/ptresearch/AttackDetection; sid: 10002269; rev: 1;)

alert tcp $HOME_NET 5672 -> $HOME_NET any (msg: "ATTACK [PTsecurity] Spring AMQP <1.7.4, 1.6.11, 1.5.7 Java Object Deserialization RCE (CVE--2017-8045)"; flow: established, no_stream; content: "application/x-java-serialized-object"; nocase; content: "|03|"; distance: 1; within: 1; content: "java."; distance: 0; pcre: "/application/x-java-serialized-object.{0,110}(?:org\.(?:apache\.|springframework\.|jboss\.|hibernate\.)|java(?:x\.management\.|\.rmi\.)|com\.sun\.|sun\.reflect\.)/"; reference: cve, 2017-8045; reference: url, pivotal.io/security/cve-2017-8045; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002274; rev: 1; )

alert smtp any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Exim 4.88, 4.89 UAF RCE Attempt (CVE-2017-16943)"; flow: established, to_server; content: "BDAT"; content: "BDAT"; within: 10; pcre: "/BDAT\s*\D[^\n\r]*[\n\r][^\n\r]{100}/"; reference: cve, 2017-16943; reference: url, bugs.exim.org/show_bug.cgi?id=2199; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002280; rev: 2; )

alert tcp any any -> any 389 (msg: "POLICY [PTsecurity] LDAP Cleartext credentials exposure"; flow: established, to_server, no_stream; content: "|30|"; depth: 1; content: "|02 01|"; distance: 1; within: 2; content: "|60|"; distance: 1; within: 1; content: "|02 01|"; distance: 1; within: 2; content: "|04|"; distance: 1; within: 1; byte_jump: 1, 0, relative; content: "|80|"; within: 1; content:!"|00|"; within: 1; reference: url, github.com/ptresearch/AttackDetection; classtype: successful-recon-limited; sid: 10002317; rev: 2;)

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] WordPress Plugin LearnDash LMS <2.5.4 Arbitrary file upload"; flow: established, to_server; content: "POST"; http_method; content: "multipart/form-data"; http_header; content: "course_id"; http_client_body; content: "uploadfile"; http_client_body; content: "uploadfiles[]"; http_client_body; content: "filename"; http_client_body; distance: 0; content: ".php.php"; http_client_body; distance: 0; pcre: "/\.php\.php\s*[\x22\']/P"; reference: url, seclists.org/fulldisclosure/2018/Jan/37; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002405; rev: 2; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] SAP NetWeaver AS Java UDDI 7.11-7.50 SQL Injection (CVE-2016-2386)"; flow: established, to_server; content: "POST"; http_method; content: "/UDDISecurityService/UDDISecurityImplBean"; http_uri; fast_pattern; content: "permissionId"; http_client_body; content: "|27|"; http_client_body; distance: 0; pcre: "/permissionId\s*>[^<]+?\x27/Pi"; reference: cve, 2016-2386; reference: url, github.com/vah13/SAP_exploit; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10002408; rev: 1; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] GitStack Arbitrary PHP upload RCE (CVE-2018-5955)"; flow: established, to_server; content: "/web/index.php?"; http_uri; content: ".git"; distance: 0; http_uri; content: "Authorization:"; http_header; nocase; content: "Basic"; distance: 0; http_header; nocase; pcre: "/Basic\s+/i"; base64_decode: offset 0, relative; base64_data; pcre: "/&\s/"; reference: url, blogs.securiteam.com/index.php/archives/3557; reference: cve, CVE-2018-5955; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002449; rev: 2;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Mikrotik Router OS 6.38.4 Stack Clash RCE"; flow: established, to_server; content: "POST"; http_method; content: "/jsproxy"; http_uri; fast_pattern; content: "Content-Length: "; http_header; content: !"|0D|"; within: 5; http_header; xbits: set, RouterOS.StackClash.POST2, track ip_src, expire 10; flowbits: noalert; reference: url, github.com/BigNerd95/Chimay-Red/blob/master/StackClashMIPS.py; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002456; rev: 1; )

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Mikrotik Router OS 6.38.4 Stack Clash RCE"; flow: established, to_server, no_stream; content: "|24 50 00 00 26 04 00 40 AE 04 FF F0 26 11 00 50 AE 11 FF F4 26 11 00 60 AE 11 FF F8 22 05 FF F0 22 06 FF FC 24 02 0F AB 00 00 00 0C|"; content: "/bin"; within: 30; xbits: isset, RouterOS.StackClash.POST2, track ip_src; reference: url, github.com/BigNerd95/Chimay-Red/blob/master/StackClashMIPS.py; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002457; rev: 1; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] Possible Mikrotik Router OS 6.38.4 Stack Clash RCE"; flow: established, to_server; content: "POST"; http_method; content: "/jsproxy"; http_uri; fast_pattern; content: "Content-Length: "; http_header; content: !"|0D|"; within: 6; http_header; byte_test: 0, =, 167936, 0, relative, string; threshold: type both, track by_src, count 2, seconds 5; reference: url, github.com/BigNerd95/Chimay-Red/blob/master/StackClashMIPS.py; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002459; rev: 2; )

alert icmp any any -> any any (msg: "ATTACK [PTsecurity] Dnsmasq <2.78 Heap Based Buffer Overflow (CVE-2017-14492)"; itype:133; icode: 0; content: "|01|"; offset: 4; depth: 1; byte_test: 1, >, 150, 0, relative; isdataat:1500, relative; reference: cve, 2017-14492; reference: url, security.googleblog.com/2017/10/behind-masq-yet-more-dns-and-dhcp.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002469; rev: 2; )

alert udp any any -> any 547 (msg: "ATTACK [PTsecurity] Possible Dnsmasq <2.78 DHCPv6 Link Layer Address Stack Overflow (CVE-2017-14493)"; flow: no_stream; content: "|0C|"; depth: 1; content: "|00 4F|"; distance: 33; within: 2; byte_test: 2, >, 16, 0, relative, big; isdataat:18,relative; reference: cve, 2017-14493; reference: url, security.googleblog.com/2017/10/behind-masq-yet-more-dns-and-dhcp.html; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002473; rev: 1; )

alert udp any any -> any 547 (msg: "ATTACK [PTsecurity] Possible Dnsmasq <2.78 DHCPv6 Sensitive info leak (CVE-2017-14494)"; flow: no_stream; content: "|0C|"; depth: 1; content: "|00 09|"; distance: 33; within: 2; content: "|00 01|"; distance: 24; within: 2; byte_test: 2, >, 2, 0, relative, big; isdataat:!3,relative; reference: cve, 2017-14494; reference: url, security.googleblog.com/2017/10/behind-masq-yet-more-dns-and-dhcp.html; classtype: attempted-recon; reference: url, github.com/ptresearch/AttackDetection; sid: 10002475; rev: 1; )

#alert udp any 53 -> $HOME_NET any (msg: "ATTACK [PTsecurity] DNS Rebinding attack in progress"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 4; content: "|00 01 00 01 00 00 00 00 00 04|"; distance: 0; content: !"|7F|"; within: 1; xbits: set, DNSREBINDING.NON_LOCALHOST, track ip_pair, expire 10; flowbits: noalert; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002488; rev: 2; )

#alert udp any 53 -> $HOME_NET any (msg: "ATTACK [PTsecurity] DNS Rebinding attack in progress"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 4; content: "|00 01 00 01 00 00 00 00 00 04 7F 00 00 01|"; distance: 0; xbits: isset, DNSREBINDING.NON_LOCALHOST, track ip_pair; threshold: type both, track by_src, count 1, seconds 30; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002489; rev: 1; )

#alert udp any 53 -> $HOME_NET any (msg: "ATTACK [PTsecurity] Possible DNS Rebinding attack"; flow: established, from_server; content: "|00 01 00 01|"; offset: 4; depth: 4; content: "|00 01 00 01 00 00 00 00 00 04 7F 00 00 01|"; distance: 0; threshold: type both, track by_src, count 1, seconds 30; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002490; rev: 1; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] GitHub Electron <1.8.2-beta.4, <1.7.11, <1.6.16 protocol handler RCE (CVE-2018-1000006)"; flow: established, from_server; content: "://"; content: "--gpu-launcher="; nocase; pcre: "/(powershell|cmd|python|bash|\.exe)/i"; reference: cve, 2018-1000006; reference: url, electronjs.org/blog/protocol-handler-fix; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002500; rev: 2; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] GitHub Electron <1.8.2-beta.4, <1.7.11, <1.6.16 protocol handler RCE (CVE-2018-1000006)"; flow: established, from_server; content: "://"; content: "-cmd-prefix="; nocase; pcre: "/(powershell|cmd|python|bash|\.exe)/i"; reference: cve, 2018-1000006; reference: url, electronjs.org/blog/protocol-handler-fix; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002501; rev: 3; )

alert tcp !$DC_SERVERS any -> $DC_SERVERS [1024:] (msg: "ATTACK AD [PTsecurity] DCShadow Replication Attempt"; flow: established, to_server; content: "|05 00 0B|"; depth: 3; content: "|35 42 51 E3 06 4B D1 11 AB 04 00 C0 4F C2 DC D2|"; distance: 0; flowbits: set, RPC.Bind.DRSUAPI; flowbits: noalert; reference: url, blog.alsid.eu/dcshadow-explained-4510f52fc19d; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002557; rev: 2; )

alert tcp !$DC_SERVERS any -> $DC_SERVERS [1024:] (msg: "ATTACK AD [PTsecurity] DCShadow Replication Attempt - DRSUAPI_REPLICA_ADD from non-DC"; flow: established, to_server, no_stream; content: "|05 00 00 03|"; depth: 4; content: "|05 00|"; distance: 18; within: 2; flowbits: isset, RPC.Bind.DRSUAPI; reference: url, blog.alsid.eu/dcshadow-explained-4510f52fc19d; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002558; rev: 1; )

alert tcp !$DC_SERVERS any -> $DC_SERVERS 389 (msg: "ATTACK [PTsecurity] DCShadow: Fake DC Creation"; flow: established, to_server; content: "|68 84 00|"; content: "CN="; distance: 5; within: 3; content: "CN=Servers,CN="; distance: 0; content: ",CN=Sites,CN=Configuration,DC="; distance: 0; content: "objectClass"; distance: 0; content: "server"; distance: 0; reference: url, blog.alsid.eu/dcshadow-explained-4510f52fc19d; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002559; rev: 2; )

#alert dcerpc any any -> $HOME_NET any (msg: "ATTACK AD [PTsecurity] DCShadow Replication Attempt - DRSUAPI_REPLICA_ADD"; flow: established; dce_iface: e3514235-4b06-11d1-ab04-00c04fc2dcd2; dce_opnum: 5; reference: url, blog.alsid.eu/dcshadow-explained-4510f52fc19d; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002570; rev: 1; )

alert tcp any any -> $HOME_NET 25 (msg: "ATTACK [PTsecurity] Exim <4.90.1 Base64 Overflow RCE (CVE-2018-6789)"; flow: established, to_server, only_stream; content: "|0D 0A|AUTH"; pcre: "/AUTH\s+\S+\s+(?:[a-zA-Z0-9\+\/=]{4})*+[a-zA-Z0-9\+\/=]{3}\s/"; reference: cve, 2018-6789; reference: url, https://devco.re/blog/2018/03/06/exim-off-by-one-RCE-exploiting-CVE-2018-6789-en/; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10002643; rev: 3; )

alert tcp any any -> $HOME_NET 139 (msg: "ATTACK [PTsecurity] Mikrotik <6.41.3 <6.42rc27 RCE Attempt (CVE-2018-7445)"; flow: established, to_server, no_stream; content: "|81 00|"; depth: 2; byte_test: 1, >, 0x20, 2, relative; content: "|00 00 00|"; distance: 0; reference: cve, 2018-7445; reference: url, www.coresecurity.com/advisories/mikrotik-routeros-smb-buffer-overflow; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002680; rev: 1; )

alert tcp any any -> $HOME_NET 139 (msg: "ATTACK [PTsecurity] ShellCode Upload Mikrotik <6.41.3 <6.42rc27 RCE (CVE-2018-7445)"; flow: established, to_server, only_stream; content: "|00 00 eb 02 00 00 eb 02|"; depth: 8; pcre: "/(?:\x00\x00\xeb\x02){10}/R"; reference: cve, 2018-7445; reference: url, www.coresecurity.com/advisories/mikrotik-routeros-smb-buffer-overflow; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002681; rev: 1; )

alert tcp $HOME_NET 139 -> any any (msg: "ATTACK [PTsecurity] Successful Mikrotik <6.41.3 <6.42rc27 RCE (CVE-2018-7445)"; flow: established, from_server, no_stream; content: "sh: "; depth: 4; reference: cve, 2018-7445; reference: url, www.coresecurity.com/advisories/mikrotik-routeros-smb-buffer-overflow; classtype: successful-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002682; rev: 1; )

alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Neutrino Bot Check-in"; flow: established, to_server; content: "msg=Y21kJ"; http_client_body; depth: 9; fast_pattern; classtype: trojan-activity; metadata: created_at 2018_3_20; reference: url, github.com/ptresearch/AttackDetection; sid: 10002712; rev: 1; )

alert tcp any any -> $HOME_NET 4786 (msg: "ATTACK [PTsecurity] Cisco Smart Install 15.2(5)E RCE (CVE-2018-0171)"; flow: established, to_server, no_stream; content: "|00 00 00 01 00 00 00 07|"; offset: 4; depth: 8; content: "|00 00 00 01|"; distance: 4; within: 4; isdataat: 210, relative; reference: cve, 2018-0171; reference: url, embedi.com/blog/cisco-smart-install-remote-code-execution; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002774; rev: 1; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] Drupalgeddon2 <8.3.9 <8.4.6 <8.5.1 RCE through registration form (CVE-2018-7600)"; flow: established, to_server; content: "/user/register"; http_uri; content: "POST"; http_method; content: "drupal"; http_client_body; pcre: "/(%23|#)(access(?:_|%5f)callback|pre(?:_|%5f)render|post(?:_|%5f)render|lazy(?:_|%5f)builder)/Pi"; reference: cve, 2018-7600; reference: url, research.checkpoint.com/uncovering-drupalgeddon-2; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10002808; rev: 3;)

alert tcp $HOME_NET 3389 -> any any (msg: "ATTACK [PTsecurity] MS RDP CredSSP Remote Code Execution MitM (CVE-2018-0886)"; flow: established, from_server, only_stream; content: "|16 03|"; content: "|0B|"; distance: 3; within: 1; content: "|06 09 2a 86 48 86 f7 0d 01 01 01|"; distance: 0; content: "D|00|i|00|s|00|a|00|l|00|l|00|o|00|w|00|S|00|t|00|a|00|r|00|t|00|I|00|f|00|O|00|n|00|B|00|a|00|t|00|t|00|e|00|r|00|i|00|e|00|s|00|"; nocase; distance: 0; content: "E|00|x|00|e|00|c|00|"; nocase; distance: 0; content: "C|00|o|00|m|00|m|00|a|00|n|00|d|00|"; nocase; distance: 0; reference: cve, 2018-0886; reference: url, blog.preempt.com/how-we-exploited-the-authentication-in-ms-rdp; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002831; rev: 1; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Drupalgeddon2 <7.5.9 <8.4.8 <8.5.3 RCE (CVE-2018-7602)"; flow: established, to_server; content: "markup"; http_uri; pcre: "/(%2523|%23|#)markup/U"; pcre: "/(%2523|%23|#)type/U"; reference: cve, 2018-7602; reference: url, www.bleepingcomputer.com/news/security/hackers-dont-give-site-owners-time-to-patch-start-exploiting-new-drupal-flaw-within-hours/; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002866; rev: 1; )

alert udp any 67 -> $HOME_NET 68 (msg: "ATTACK [PTsecurity] DHCP Client Script WPAD option OS Command Injection (CVE-2018-1111)"; content: "|63 82 53 63|"; fast_pattern; content: "|FC|"; distance: 0; byte_extract: 1, 0, length, relative; content: "'"; within:length; pcre: "/[\x79\x28-\x2a\x77\xf9\x21\x2a\x35\x36\x33\x3a\x3b\x01-\x0f\x1a\x1c]/"; content:!"|00|"; within: 1; content:!"|01|"; within: 1; content:!"|02|"; within: 1; byte_jump: 1, 0, relative; content: "|FC|"; within: 1; byte_extract: 1, 0, length, relative; content: "'"; within:length; reference: cve, 2018-1111; reference: url, dynoroot.ninja; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002971; rev: 2; )

alert udp any 67 -> $HOME_NET 68 (msg: "ATTACK [PTsecurity] DHCP Client Script WPAD option Exploit (CVE-2018-1111)"; content: "|63 82 53 63|"; fast_pattern; content: "|FC|"; distance: 0; byte_extract: 1, 0, length, relative; content: "'"; within:length; pcre: "/^[\x20-\x7E]+(sh|nc|wget|curl|echo|cat|id|uname)/Ri"; reference: cve, 2018-1111; reference: url, dynoroot.ninja; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10002975; rev: 1; )

alert http $HOME_NET any -> $EXTERNAL_NET 80 (msg: "MALWARE [PTsecurity] Pegasus (Buhtrap/Ratopak) C2 connection"; flow: established, to_server; content: "POST"; http_method; content: ".php"; http_uri; content: "Content-Type: multipart/form-data|3b| boundary="; http_header; pcre: "/^[0-9a-f]{12}\r\n/RH"; content: "Content-Type: application/octet-stream"; http_client_body; content: "Content-Disposition: form-data|3b| name=|22|"; http_client_body; pcre: "/^[a-z]{8,14}\x22\r\nContent-Type: application/octet-stream\r\n\r\n(.{192}){1,2}\r\n--[0-9a-z]{12}--/RPs"; pcre: "/[\x0e-\x19\x80-\xff]{4}/P"; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 10003298; rev: 1; )

alert udp $HOME_NET any -> $HOME_NET 138 (msg: "MALWARE [PTsecurity] Pegasus (Buhtrap/Ratopak) credentials broadcast via Mailslot"; content: "|5C|MAILSLOT|5C|"; content: !"|00|"; within: 16; pcre: "/^[0-9A-F]{16,32}\x00/R"; pcre: "/[\x0e-\x19\x80-\xff]{5}/R"; threshold: type both, track by_src, count 4, seconds 3600; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 10003304; rev: 1; )

alert tcp $HOME_NET any -> $HOME_NET 445 (msg: "MALWARE [PTsecurity] Pegasus (Buhtrap/Ratopak) domain replication remote pipe check"; flow: established, to_server, no_stream; content: "SMB"; content: "|0B 00|"; distance: 8; within: 2; content: "|00 00 18 00 11 00 FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF|"; distance: 0; pcre: "/([0-9A-F]\x00){16,32}$/R"; threshold: type threshold, track by_src, count 8, seconds 2; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 10003305; rev: 1; )

alert http any any -> $HOME_NET any (msg: "ATTACK [PTsecurity] Modx Revolution CMS < 2.6.4 RCE by PoC (CVE-2018-1000207)"; flow: established, to_server; content: "POST"; http_method; content: "/connectors/system/phpthumb.php"; http_uri; content: "IMresizedData"; nocase; http_client_body; content: "cache_filename"; nocase; http_client_body; reference: cve, 2018-1000207; reference: url, rudnkh.me/posts/critical-vulnerability-in-modx-revolution-2-6-4; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003350; rev: 1;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] PHP Object Deserialization RCE POP Chain (Guzzle/RCE1)"; flow: established; content: "GuzzleHttp"; content: "Psr7"; distance: 0; content: "FnStream"; distance: 0; content: "close"; distance: 0; content: "GuzzleHttp"; distance: 0; content: "HandlerStack"; distance: 0; content: "resolve"; distance: 0; reference: url, github.com/ambionics/phpggc; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003494; rev: 2; )

alert http any any -> any any (msg: "SCAN [PTsecurity] Neutrino shell probing die(@md5("; flow: established, to_server; content: "die(@md5("; isdataat: !20, relative; threshold: type limit, track by_src, seconds 300, count 1; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-recon; sid: 10003765; rev: 2; )

alert http any any -> any any (msg: "SCAN [PTsecurity] Neutrino shell probing die(md5("; flow: established, to_server; content: "die(md5("; isdataat: !20, relative; threshold: type limit, track by_src, seconds 300, count 1; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-recon; sid: 10003766; rev: 2; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] Apache Portals Pluto 3.0.0 RCE (CVE-2018-1306)"; flow: established, to_server; content: "HEAD"; http_method; content: "/pluto/portal/File Upload"; http_uri; depth: 25; content: "<%"; http_client_body; content: ".jsp"; http_client_body; reference: cve, 2018-1306; reference: url, packetstormsecurity.com/files/149366/apacheportalspluto300-exec.txt; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10003786; rev: 1; )

alert udp any any -> any any (msg: "ATTACK [PTsecurity] Cisco Prime Infrastructure < 3.4.1 & 3.3.1 TFTP RCE (CVE-2018-15379)"; flow: established, from_server; content: "|00 03 00 01|"; depth: 4; content: "<%@"; flowbits: set, CVE.2018-15379.JSP1; flowbits: noalert; reference: cve, 2018-15379; reference: url, seclists.org/fulldisclosure/2018/Oct/19; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003907; rev: 1; )

alert udp any any -> any any (msg: "ATTACK [PTsecurity] Cisco Prime Infrastructure < 3.4.1 & 3.3.1 TFTP RCE (CVE-2018-15379)"; flow: established, from_server; content: "|00 03 00|"; depth: 3; content: "/CSCOlumos/"; content: "runrshell"; distance: 0; flowbits: isset, CVE.2018-15379.JSP1; reference: cve, 2018-15379; reference: url, seclists.org/fulldisclosure/2018/Oct/19; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003908; rev: 1; )

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Mikrotik <6.42 Password disclosure path traversal (CVE-2018-14847)"; flow: established, to_server; content: "|01 00|"; offset: 1; depth: 2; content: "M2"; distance: 1; within: 2; content: "/../"; distance: 0; content: "/flash/rw/store/user.dat"; distance: 0; content: "|02 00 00 00 02 00 00 00|"; distance: 0; reference: cve, 2018-14847; reference: url, github.com/tenable/routeros/tree/master/poc/bytheway; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003917; rev: 1; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] MS Edge WScript Command Injection RCE (CVE-2018-8495)"; flow: established, from_server; content: "wshfile:"; nocase; http_server_body; fast_pattern; content: ".."; distance: 0; http_server_body; content: ".vbs"; distance: 0; nocase; http_server_body; pcre: "/wshfile:[^\x22\x27\s]+(\\|\/)\.\.(\\|\/)[^\x22\x27\s]+\.vbs/Qi"; reference: cve, 2018-8495; reference: url, leucosite.com/Microsoft-Edge-RCE; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003930; rev: 2; )

alert tcp any any -> any 445 (msg: "ATTACK [PTsecurity] Webexservice Service Probe (CVE-2018-15442)"; flow: established, to_server, no_stream; content: "SMB"; depth: 8; content: "|05 00 00|"; distance: 0; content: "|10 00|"; distance: 19; within: 3; content: "w|00|e|00|b|00|e|00|x|00|s|00|e|00|r|00|v|00|i|00|c|00|e|000000|"; nocase; distance: 0; reference: url, webexec.org; reference: cve, 2018-15442; flowbits: set, CVE.2018-15442.Probe; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003982; rev: 1; )

alert tcp any any -> any 445 (msg: "ATTACK [PTsecurity] Webexservice remote priveleged command execution (CVE-2018-15442)"; flow: established, to_server, no_stream; content: "SMB"; depth: 8; content: "|05 00 00|"; distance: 0; content: "|13 00|"; distance: 19; within: 3; content: "s|00|o|00|f|00|t|00|w|00|a|00|r|00|e|00|-|00|u|00|p|00|d|00|a|00|t|00|e|00|"; nocase; distance: 0; reference: url, webexec.org; reference: cve, 2018-15442; flowbits: isset, CVE.2018-15442.Probe; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10003983; rev: 1; )

alert udp any any -> $HOME_NET 5060 (msg: "ATTACK [PTSecurity] Cisco ASA and Cisco FTD possible DoS (CVE-2018-15454)"; flow: no_stream; content: "SIP|2f|"; nocase; content: "Via:"; nocase; distance: 0; content: "SIP|2f|"; nocase; distance: 0; content: "|2f|UDP"; nocase; distance: 0; within: 10; content: "0.0.0.0"; distance: 0; within: 15; fast_pattern; content: "branch="; nocase; distance: 0; reference: url, www.securityfocus.com/bid/105768/; reference: cve, 2018-15454; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10004025; rev: 1;)

alert smb any any -> any any (msg: "ATTACK AD [PTsecurity] SPOOLSS DCERPC/SMB Bind"; flow: to_server, established, no_stream; content:"SMB"; offset: 5; depth: 3; content: "|05 00 0B|"; distance: 0; content: "|78 56 34 12 34 12 cd ab ef 00 01 23 45 67 89 ab 01 00 00 00|"; distance: 29; flowbits: set, DCERPC.BIND.SPOOLSS; flowbits: noalert; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-recon; sid: 10004152; rev: 1; )

alert smb any any -> $DC_SERVERS 445 (msg: "ATTACK AD [PTsecurity] Possible MS-RPRN abuse. Hash or Ticket theft"; flow: to_server, established, no_stream; content:"SMB"; offset: 5; depth: 3; content: "|05 00 00|"; distance: 0; content: "|41 00|"; distance: 19; within: 2; content: "|00 01 00 00|"; distance: 36; within: 4; content: "|5C 00 5C 00|"; fast_pattern; distance: 0; flowbits: isset, DCERPC.BIND.SPOOLSS; reference: url, posts.specterops.io/not-a-security-boundary-breaking-forest-trusts-cd125829518d; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-recon; sid: 10004153; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Kibana < 6.4.3 <5.6.13 Arbitrary File Inclusion/Disclosure/RCE attempt (CVE-2018-17245)"; flow: established, to_server; content: "/api/console/api_server"; http_uri; content: "SENSE_VERSION"; nocase; http_uri; distance: 0; pcre: "/apis\s*=\s*[^&]*(?:(?:%2e|\.)(?:%2e|\.)(?:%5c|%2f|\/|\\))/Ui"; reference: cve, 2018-17245; reference: url, www.cyberark.com/threat-research-blog/execute-this-i-know-you-have-it; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004231; rev: 1; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] MS Exchange 2010-2019 Possible privilege escalation (CVE-2018-8581)"; flow: established, to_server; content: "POST"; http_method; content: "SOAPAction"; http_header; content: "Authorization: NTLM"; http_header; content: "m:SendNotificationResponseMessage"; http_client_body; reference: url, dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/; reference: cve, 2018-8581; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004420; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Raisecom GPON RCE via command injection (CVE-2019-7385)"; flow: established, to_server; content: "POST"; http_method; content: "/boaform/formPasswordSetup"; http_uri; content: "confpass"; http_client_body; pcre: "/(newpass|confpass)\s*=\s*\x60/P"; reference: cve, 2019-7385; reference: url, s3curityb3ast.github.io/KSA-Dev-006.md; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004526; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Raisecom GPON RCE via command injection (CVE-2019-7384)"; flow: established, to_server; content: "POST"; http_method; content: "/boaform/admin/formgponConf"; http_uri; content: "fmgpon_loid"; http_client_body; pcre: "/fmgpon_loid\s*=\s*(\x7c|%7c)/P"; reference: cve, 2019-7384; reference: url, s3curityb3ast.github.io/KSA-Dev-005.md; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004527; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Jenkins sandbox bypassing RCE (CVE-2019-1003000/1/2)"; flow: established, to_server; content: "POST"; http_method; nocase; content: "/job/"; http_uri; depth: 5; content: "/config.xml"; http_uri; content: "script"; http_client_body; pcre: "/<\s*script\s*>.*?@(Grab|ASTTest)/Ps";  reference: url, github.com/adamyordan/cve-2019-1003000-jenkins-rce-poc; reference: cve, 2019-1003000; reference: cve, 2019-1003001; reference: cve, 2019-1003002; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004529; rev: 1; )

alert tcp any any -> any 8291 (msg: "ATTACK [PTsecurity] MikroTik Firewall & NAT Bypass (CVE-2019-3924)"; flow: established, no_stream, to_server; content: "|01 00|"; depth: 4; content: "M2"; depth: 8; content: "|68 00 00 00|"; isdataat: !1, relative; content: "|07 00 FF 09 01|"; content: "|03 00 00 08|"; content: "|04 00 00 09|"; content: "|07 00 00 21|"; content: "|08 00 00 21|"; reference: cve, 2019-3924; reference: url, www.tenable.com/security/research/tra-2019-07; reference: url, github.com/tenable/routeros/blob/master/poc/cve_2019_3924; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10004547; rev: 1; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] Arbitrary PHP RCE in Drupal 8 < 8.5.11,8.6.10 (CVE-2019-6340)"; flow: established, to_server; content: "GET"; http_method; content: "hal_json"; http_uri; content: "link"; http_client_body; content: "options"; distance: 0; content: "O:"; distance: 0; http_client_body; pcre: "/\x22options\x22\s*:\s*\x22O:\d+:/P"; reference: cve, 2019-6340; reference: url, www.ambionics.io/blog/drupal8-rce; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004555; rev: 3; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] PHPMyAdmin web shell planting with log redirection"; flow: established, to_server; content: "POST"; http_method; content: "import.php"; http_uri; content: "application/x-www-form-urlencoded"; http_header; content: "general_log_file"; http_client_body; fast_pattern; content: ".php"; http_client_body; distance: 0; pcre: "/general_log_file[^&]+\.php(\x22|\x27|\s|%27|%22|%20)/P"; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004566; rev: 1; )

alert http any any -> any any (msg: "ATTACK [PTsecurity] Possible Apache Axis RCE via SSRF (CVE-2019-0227)"; flow: established, to_client; content: "30"; http_stat_code; content: "Location:"; http_header; content: "method"; distance: 0; http_header; pcre: "/(!|%21)(-|%2D|)+(>|%3E)/RHi"; content: "deployment"; distance: 0; http_header; reference: cve, 2019-0227; reference: url, rhinosecuritylabs.com/application-security/cve-2019-0227-expired-domain-rce-apache-axis; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10004698; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Confluence <6.14.2,6.13.3,6.12.3 Unauthorized RCE (CVE-2019-3396)"; flow: established, to_server; content: "/rest/tinymce/"; http_uri; content: "/macro/preview"; http_uri; distance: 0; content: "contentId"; http_client_body; content: "_template"; http_client_body; content: "url"; http_client_body; reference: url, paper.seebug.org/886; reference: cve, 2019-3396; classtype: attempted-admin; reference: url, github.com/ptresearch/AttackDetection; sid: 10004699; rev: 1; )

alert  tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] AES.DDoS.Dofloo";flow: established, to_server; stream_size: server, =, 1; content: "VERSONEX";depth:  60; classtype: trojan-activity; metadata: created_at 2019_04_11; reference: url, github.com/ptresearch/AttackDetection; sid: 10004700; rev: 1;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] AES.DDoS.Dofloo";flow: established, to_server; dsize: 20; content: "|49 4e 46 4f 3a 30 2e 30 25 7c 30 2e 30|";depth: 13; content: "|20 4d 62 70 73 00|"; distance: 1; within:   6;classtype: trojan-activity; metadata: created_at 2019_04_11; reference: url, github.com/ptresearch/AttackDetection; sid: 10004701; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Oracle Weblogic _async deserialization RCE Attempt (CVE-2019-2725)"; flow: established, to_server; content: "POST"; nocase; http_method; content: "oracle.toplink.internal.sessions.UnitOfWorkChangeSet"; pcre: "/(/wls-wsat/|/__async/)/I"; reference: cve, 2019-2725; reference: url, paper.seebug.org/910/; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004779; rev: 3;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Oracle Weblogic file upload RCE (CVE-2019-2618)"; flow: established, to_server; content: "POST"; nocase; http_method; content: "/bea_wls_deployment_internal/DeploymentService"; http_uri; content: "app_upload"; http_header; content: "_WL_internal"; http_header; content: "bea_wls_"; http_header; distance: 0; reference: cve, 2019-2618; reference: url, github.com/jas502n/cve-2019-2618/blob/master/cve-2019-2618.py; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004781; rev: 1;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #1)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 20|"; depth: 5; fast_pattern; content: "|17 03 01|"; distance: 32; within: 3; byte_test: 2, >, 450, 0, relative, big; flowbits: set, BlueKeep.pkt1; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004861; rev: 4;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #2)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 20|"; depth: 5; content: "|17 03 01 00 30|"; distance: 32; within: 5;  fast_pattern; flowbits: isset, BlueKeep.pkt1; flowbits: set, BlueKeep.pkt2; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004862; rev: 4;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #3)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 20|"; depth: 5; content: "|17 03 01 00 20|"; distance: 32; within: 5;  fast_pattern; flowbits: isset, BlueKeep.pkt2; flowbits: set, BlueKeep.pkt3; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004863; rev: 4;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (MCS Channel Join Requests)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 20|"; depth: 5; content: "|17 03 01 00 30|"; distance: 32; within: 5;  fast_pattern; flowbits: isset, BlueKeep.pkt3; flowint: JoinReq, +, 1; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004864; rev: 4;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #12)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 20|"; depth: 5; content: "|17 03 01 01 80|"; distance: 32; within: 5; flowint: JoinReq, >=, 7; flowbits: set, BlueKeep.pkt12; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004865; rev: 7;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708"; flow: established, from_server; app-layer-protocol:!tls; stream_size: client, <, 3500; stream_size: server, <, 3000; content: "|17 03 01 01 d0|"; depth: 5; flowbits: isset, BlueKeep.pkt12; flowbits: set, BlueKeep.pkt13; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004867; rev: 5;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Oracle Weblogic _async deserialization RCE Attempt (CVE-2019-2725)"; flow: established, to_server; content: "POST"; nocase; http_method; content: "org.slf4j.ext.EventData"; pcre: "/(/wls-wsat/|/__async/)/I"; reference: cve, 2019-2725; reference: url, paper.seebug.org/910/; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004927; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Apache Tomcat RCE on Windows (CVE-2019-0232)"; flow: established, to_server; content: "?&"; http_raw_uri; pcre: "/\.(?:bat|cmd)\?\&/I"; reference: cve, 2019-0232; reference: url, wwws.nightwatchcybersecurity.com/2019/04/30/remote-code-execution-rce-in-cgi-servlet-apache-tomcat-on-windows-cve-2019-0232; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10004953; rev: 2;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Redis Master-Slave replication RCE successful"; flow: established, to_client; content: "FULLRESYNC"; nocase; depth: 20; content: "|7F|ELF"; within: 70; reference: url, paper.seebug.org/977; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005212; rev: 1;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #1)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01|"; depth: 3; byte_test: 2, >, 450, 0, relative, big; flowbits: set, BlueKeep.pkt1; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005396; rev: 1;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #2)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 30|"; depth: 5;  fast_pattern; flowbits: isset, BlueKeep.pkt1; flowbits: set, BlueKeep.pkt2; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005397; rev: 1;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #3)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 20|"; depth: 5; flowbits: isset, BlueKeep.pkt2; flowbits: set, BlueKeep.pkt3; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005398; rev: 1;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (MCS Channel Join Requests)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 00 30|"; depth: 5; flowbits: isset, BlueKeep.pkt3; flowint: JoinReq, +, 1; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005399; rev: 1;)

alert tcp any any -> any !443 (msg: "ATTACK [PTsecurity] Possible Bluekeep RDP exploit CVE-2019-0708 (pkt #12)"; flow: established, to_server; app-layer-protocol:!tls; content: "|17 03 01 01 80|"; depth: 5; flowint: JoinReq, >=, 7; flowbits: set, BlueKeep.pkt12; flowbits: noalert; reference: cve, 2019-0708; reference: url, github.com/Ekultek/BlueKeep; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005400; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] vBulletin 5.x pre-auth RCE"; flow: established, to_server; content: "POST"; http_method; content: "routestring"; http_client_body; content: "widget_php"; within: 30; http_client_body; pcre: "/ajax.{1,6}render.{1,6}widget_php/P"; pcre: "/widgetConfig.{1,6}code/P"; reference: url, seclists.org/fulldisclosure/2019/Sep/31; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005417; rev: 1;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Mikrotik RouterOS unauthenticated DNS cache poisoning (CVE-2019-3978)"; flow: established, to_server, no_stream; content: "M2"; offset: 4; depth: 2; content: "|01 00 00 08|"; content: "|07 00 FF 09 03|"; content: "|03 00 00 21|"; content: "|01 00 FF 88 01 00 0E 00 00 00|"; reference: cve, 2019-3978; reference: cve, medium.com/tenable-techblog/routeros-chain-to-root-f4e0b07c0b21; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005475; rev: 1;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] rConfig ajaxServerSettingsChk.php unauth RCE (CVE-2019-16662)"; flow: established, to_server; content: "ajaxserversettingschk.php"; http_uri; nocase; pcre: "/(?:\x3b|\x26|\x7C|%3b|%7c|%26)/iRU"; reference: url, shells.systems/rconfig-v3-9-2-authenticated-and-unauthenticated-rce-cve-2019-16663-and-cve-2019-16662; reference: cve, 2019-16662; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005501; rev: 4;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] rConfig search.crud.php unauth RCE (CVE-2019-16663)"; flow: established, to_server; content: "search.crud.php"; http_uri; nocase; pcre: "/(?:\x3b|\x26|\x7C|%3b|%7c|%26)/iRU"; reference: url, shells.systems/rconfig-v3-9-2-authenticated-and-unauthenticated-rce-cve-2019-16663-and-cve-2019-16662; reference: cve, 2019-16663; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005502; rev: 4;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] Suspicious explicitly-defined ECC parameters. Possible CVE-2020-0601 crafted certificate"; flow:established; content:"|06 07 2a 86 48 ce 3d 02 01 30 82|"; content:"|06 07 2a 86 48 ce 3d 01 01 02|"; within:200; reference: cve, 2020-0601; reference: url, github.com/ollypwn/cve-2020-0601; reference: url, github.com/ptresearch/AttackDetection; classtype: trojan-activity; sid: 10005695; rev: 1;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] CoronaBlue/SMBGhost DOS/RCE Attempt (CVE-2020-0796)"; flow: established; content: "|FC|SMB"; depth: 8; byte_test: 4, >, 0x800134, 8, relative, little; reference: url, www.mcafee.com/blogs/other-blogs/mcafee-labs/smbghost-analysis-of-cve-2020-0796; reference: cve, 2020-0796; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005777; rev: 2;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] CoronaBlue/SMBGhost DOS/RCE Attempt (CVE-2020-0796)"; flow: established; content: "|FC|SMB"; depth: 8; byte_test: 4, >, 0x800134, 0, relative, little; reference: url, www.mcafee.com/blogs/other-blogs/mcafee-labs/smbghost-analysis-of-cve-2020-0796; reference: cve, 2020-0796; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005778; rev: 2;)

alert tcp any any -> any any (msg: "TOOLS [PTsecurity] Possible xfreerdp RDP client"; flow: established, to_server, no_stream; content: "|03 00|"; depth: 2; content: "Duca"; distance: 0; content: "|01 C0|"; distance: 2; within: 2; byte_jump: 2, 0, relative, little, post_offset -4; content: "|04 C0|"; within: 2; byte_jump: 2, 0, relative, little, post_offset -4; content: "|02 C0|"; within: 2; isdataat: !11, relative; reference: url, github.com/ptresearch/AttackDetection; classtype: bad-unknown; sid: 10005928; rev: 2;)

alert tcp any 53 -> any any (msg: "ATTACK [PTsecurity] Windows Server DNS RCE aka SIGRed (CVE-2020-1350) - Query response"; flow: established, from_server; content:"|FF|"; depth: 1; content: "|00 00 18 00 01 C0|"; within: 100; content:"|00 18 00 01|"; distance: 1; within: 4; content: "|FF|"; distance: 4; within: 1; reference: url, research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers; reference: cve, 2020-1350; reference: url, github.com/ptresearch/AttackDetection; classtype: attempted-admin; sid: 10005977; rev: 2;)

alert dns any any -> any any (msg: "TOOLS [PTsecurity] Burp Suite tool activity. portswigger.net resolve"; dns_query; content: "portswigger.net"; reference: url, github.com/ptresearch/AttackDetection; classtype: string-detect; sid: 10006023; rev: 2;)

alert http any any -> any any (msg: "ATTACK [PTsecurity] Oracle Weblogic unauth RCE (CVE-2020-14882)"; flow: established, to_server; content: "%252E%252E"; http_raw_uri; content: "console.portal"; http_uri; content: "tangosol"; content: "coherence"; distance: 0; content: "ShellSession"; distance: 0; reference: url, twitter.com/jas502n/status/1321416053050667009; reference: url, testbnull.medium.com/weblogic-rce-by-only-one-get-request-cve-2020-14882-analysis-6e4b09981dbf; reference: url, github.com/ptresearch/AttackDetection; reference: cve, 2020-14882; classtype: attempted-admin; sid: 10006254; rev: 1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "BACKDOOR [PTsecurity] SSVagent.APT31"; flow: established, to_server; content: "|00 00 00 01 00 00 00 01 00 00 00|"; offset: 1; depth: 11; http_client_body; pcre: "/^[A-F-0-9]{32}/RP"; reference: url, github.com/ptresearch/AttackDetection; metadata: created_at 2021_05_13, updated_at 2021_05_14; classtype: trojan-activity; sid: 10006530; rev: 1;)

alert http $HOME_NET any -> $EXTERNAL_NET any (msg: "BACKDOOR [PTsecurity] Possible SSVagent.APT31"; flow: established, to_server;content: "|00 00 00|"; offset: 1; depth: 3; http_client_body;pcre: "/^.{12}[A-F-0-9]{32}/P"; content: "|0d0a 0d0a|"; depth: 300; byte_jump: 1, 0, relative; isdataat: !5, relative;classtype: trojan-activity; sid: 10006531; rev: 2;)

alert tcp-pkt any any -> any any (msg: "ATTACK [PTsecurity] IREMOTEWINSPOOL Bind"; flow: established, to_server; content: "|96 3F F0 76 FD CD FC 44 A2 2C 64 95 0A 00 12 09|"; flowbits: set, DCERPC.IREMOTEWINSPOOL.Bind; flowbits: noalert; reference: url, github.com/ptresearch/AttackDetection; metadata: Open Ptsecurity.com ruleset;  metadata: created_at 2021_07_12, updated_at 2021_08_10; classtype: attempted-admin; sid: 10006624; rev: 3;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] PrintNightmare attempt (CVE-2021-1675)"; flow: established, to_server; content: "|05 00 00|"; depth: 70; content: "|27 00|"; distance: 19; within: 2; flowbits: isset, DCERPC.IREMOTEWINSPOOL.Bind; threshold: type limit, track by_dst, count 1, seconds 60; reference: url, github.com/ptresearch/AttackDetection; reference: url, github.com/gentilkiwi/mimikatz/releases/tag/2.2.0-20210709; reference: cve, 2021-1675; metadata: Open Ptsecurity.com ruleset;  metadata: created_at 2021_07_12, updated_at 2021_08_10; classtype: attempted-admin; sid: 10006625; rev: 3;)

alert tcp-pkt any any -> any any (msg: "ATTACK [PTsecurity] SPOOLSS Bind"; flow: established, to_server; content: "|78 56 34 12 34 12 CD AB EF 00 01 23 45 67 89 AB|"; flowbits: set, DCERPC.SPOOLSS.Bind; flowbits: noalert; reference: url, github.com/ptresearch/AttackDetection; metadata: Open Ptsecurity.com ruleset;  metadata: created_at 2021_07_12, updated_at 2021_08_10; classtype: attempted-admin; sid: 10006626; rev: 3;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] PrintNightmare attempt (CVE-2021-1675)"; flow: established, to_server; content: "|05 00 00|"; depth: 70; content: "|59 00|"; distance: 19; within: 2; flowbits: isset, DCERPC.SPOOLSS.Bind; threshold: type limit, track by_dst, count 1, seconds 60; reference: url, github.com/ptresearch/AttackDetection; reference: cve, 2021-1675; metadata: Open Ptsecurity.com ruleset;  metadata: created_at 2021_07_12, updated_at 2021_08_10; classtype: attempted-admin; sid: 10006627; rev: 3;)

alert tcp-pkt any any -> any any (msg: "ATTACK [PTsecurity] EFSR Bind"; flow: established, to_server; content: "|88 D4 81 C6 50 D8 D0 11 8C 52 00 C0 4F D9 0F 7E|"; flowbits: set, DCERPC.EFSR.Bind; flowbits: noalert; reference: url, github.com/ptresearch/AttackDetection; metadata: Open Ptsecurity.com ruleset; metadata: created_at 2021_07_23, updated_at 2021_08_10; classtype: attempted-admin; sid: 10006662; rev: 1;)

alert tcp-pkt any any -> any any (msg: "ATTACK [PTsecurity] EFSR /efsrpc Bind"; flow: established, to_server; content: "|C5 41 19 DF 89 FE 79 4E BF 10 46 36 57 AC F4 4D|"; flowbits: set, DCERPC.EFSR.Bind; flowbits: noalert; reference: url, github.com/ptresearch/AttackDetection; metadata: Open Ptsecurity.com ruleset; metadata: created_at 2021_07_23, updated_at 2021_08_10; classtype: attempted-admin; sid: 10006663; rev: 1;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] PetitPotam (Machine account NTLM Hash leak) attempt"; flow: established, to_server; content: "|05 00 00|"; depth: 70; content: "|00 00|"; distance: 19; within: 2; flowbits: isset, DCERPC.EFSR.Bind; xbits: set, PetitPotam.Attempt, track ip_dst, expire 10; reference: url, github.com/ptresearch/AttackDetection; reference: url, github.com/topotam/PetitPotam; metadata: Open Ptsecurity.com ruleset; metadata: created_at 2021_07_23, updated_at 2021_08_10; classtype: attempted-admin; sid: 10006664; rev: 2;)

alert tcp any any -> any any (msg: "ATTACK [PTsecurity] PetitPotam (Machine account NTLM Hash leak) successful"; flow: established, to_server; content: "SMB"; content: "NTLMSSP|00 03 00 00 00|"; distance: 0; byte_jump: 4, 36, relative, little, post_offset -55; content: "|00 24 00|"; within: 3; xbits: isset, PetitPotam.Attempt, track ip_src; reference: url, github.com/ptresearch/AttackDetection; reference: url, github.com/topotam/PetitPotam; metadata: Open Ptsecurity.com ruleset; metadata: created_at 2021_07_23, updated_at 2021_07_23; classtype: attempted-admin; sid: 10006665; rev: 2;)

alert tcp any any -> any any (msg: "BACKDOOR [PTsecurity] SSVagent.APT31 SSL certificate"; flow:established,from_server; content: "|550403|"; depth: 3000;content: "|10|www.flushcdn.com0"; distance: 1; within: 18;content: "|55040a|"; depth: 3000;content: "|08|GoGetSSL1"; distance: 1; within: 10; reference: url, github.com/ptresearch/AttackDetection; classtype: trojan-activity; sid: 10006685; rev: 1;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Babylon RAT C2 Client Request";flow: established, to_server; dsize:4; content:"|bdff 9eff|"; depth: 4; flowbits:set, PT.Babylon.RAT.Request;classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000314; rev: 1;)

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT C2 Server Response";flow: established, to_client; flowbits:isset, PT.Babylon.RAT.Request;dsize:4;content:"|c5ff 9eff|"; depth: 4; flowbits:unset, PT.Babylon.RAT.Request;classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000315; rev: 1;)

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT unset";flow: established, to_client; flowbits:isset, PT.Babylon.RAT.Request;content:!"|c5ff 9eff|"; depth: 4; flowbits:unset, PT.Babylon.RAT.Request; flowbits: noalert; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000316; rev: 1;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET [53, 443] (msg: "MALWARE [PTsecurity] Bunitu.Proxy pkt checker #0"; flow: established, to_server; dsize: 14; content: "|00|"; offset: 1; depth:1;  stream_size: server, =,1; stream_size: client, =,15; flowbits: noalert;flowbits: set, FB70820_0; classtype: trojan-activity; metadata: created_at 2017_8_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11000339; rev: 5;) 

#alert tcp $EXTERNAL_NET [53, 443] -> $HOME_NET any (msg: "MALWARE [PTsecurity] Bunitu.Proxy pkt checker #1"; flow: established, to_client; dsize: 50; content: "|00|"; offset: 1; depth:1; stream_size: server, =,51; stream_size: client, =,15; flowbits: noalert; flowbits: isset, FB70820_0; flowbits: unset, FB70820_0; flowbits: set, FB70820_1; classtype: trojan-activity; metadata: created_at 2017_8_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11000340; rev: 4;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET [53, 443] (msg: "MALWARE [PTsecurity] Bunitu.Proxy"; flow: established, to_server; dsize: 37; content: "|00|"; offset: 1; depth:1; stream_size: server, =, 51; stream_size: client, =,52; flowbits: isset, FB70820_1; classtype: trojan-activity; metadata: created_at 2017_8_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11000342; rev: 4;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ozone RAT connection";flow: established, to_server; dsize:6;content: "|0000 00|";fast_pattern;offset:2;depth: 3;content:"|01|";offset:0;depth:1;byte_test:1,>,0x10,1;byte_test:1,<,0xf0,1;stream_size: server, =, 1;stream_size: client, =, 7;classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11000431; rev: 4;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Babylon RAT (Dodiw.A VT) Check-in";flow: established, to_server, only_stream; content:!"|ff|";offset: 0; depth: 1;content: "|ff|";fast_pattern;offset: 1; depth: 1;content:!"|ff|";offset: 2; depth: 1; content: "|ff|";offset: 3; depth: 1; content:!"|ff|";offset: 4; depth: 1;pcre: "/^(.\xff.\xff).\xff.\xff\1(?!\1)/";pcre: "/^(?:.\xff){32}/";isdataat:!256;classtype: trojan-activity; metadata: created_at 2017_2_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11000978; rev: 2;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Tofsee.bot connection detected"; flow: established, to_server; flowbits: isset,PT.Tofsee_2; dsize:25; flags:PA; stream_size:client,<,350; stream_size:server,=,258; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001385; rev: 2; )

#alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] Tofsee.bot pkt200 connection"; flow: established, to_client; dsize:200; flags:PA; stream_size:client,=,1; stream_size:server,=,201; flowbits:noalert; flowbits:set, PT.Tofsee_0; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001386; rev: 2; )

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Tofsee.bot pkt97 sequence"; flow: established, to_server; dsize:97; flags:PA; stream_size:client,<,300; stream_size:server,=,258; flowbits:noalert; flowbits:isset, PT.Tofsee_1; flowbits:unset, PT.Tofsee_1; flowbits:set, PT.Tofsee_2; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001387; rev: 2; )

#alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] Tofsee.bot pkt57 connection"; flow: established, to_client; dsize:57; flags:PA; stream_size:client,<,200; stream_size:server,=,258; flowbits:isset, PT.Tofsee_0; flowbits:noalert; flowbits:unset, PT.Tofsee_0; flowbits:set, PT.Tofsee_1; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001388; rev: 2; )

#alert tcp $HOME_NET any -> $EXTERNAL_NET [20000:] (msg: "MALWARE [PTsecurity] Bayrob pkt sequence detected set";flow: established, to_server; flowbits:set,PT.Bayrob0; dsize:8; flags:PA;stream_size:client,=,9;flowbits:noalert; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, github.com/ptresearch/AttackDetection; sid: 11001392; rev: 1;)

#alert tcp $EXTERNAL_NET [20000:] -> $HOME_NET any (msg: "MALWARE [PTsecurity] Bayrob detected ";flow: established, to_client; flowbits:isset,PT.Bayrob0; dsize:2; flags:PA;stream_size:server,=,3;stream_size:client,<,400;flowbits:unset,PT.Bayrob0; classtype: trojan-activity; metadata: created_at 2017_6_2; reference: url, blog.fortinet.com/2016/07/27/bayrob-an-ancient-evil-awakens-ii; reference: url, github.com/ptresearch/AttackDetection; sid: 11001394; rev: 2;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 21|"; distance:1; fast_pattern; within:2;  stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: set, FB0_0; flowbits: isset, FB0_01; flowbits: noalert; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001460; rev: 3;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #1";flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,1420, 1, relative; byte_test: 2, <=,2096, 1, relative; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_0; flowbits: unset, FB0_0; flowbits: set, FB0_1; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001461; rev: 6;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #2"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,538, 1, relative; byte_test: 2, <=,1052, 1, relative; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_1; flowbits: unset, FB0_1; flowbits: set, FB0_2; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001462; rev: 3;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #3"; flow: established, to_client; content: "|1703 0302 1a|"; depth:5;stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_2; flowbits: noalert; flowbits: unset, FB0_2; flowbits: set, FB0_3;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001463; rev: 3;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,538, 1, relative; byte_test: 2, <=,4072, 1, relative; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_3; flowbits: unset, FB0_3; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001464; rev: 3;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,270, 1, relative; byte_test: 2, <=,292, 1, relative; stream_size: server, <,2710; stream_size: client, <,1540; flowbits: noalert; flowbits: set, FB314917_0; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11001465; rev: 2;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,400, 1, relative; byte_test: 2, <=,416, 1, relative; stream_size: server, <,2710; stream_size: client, <,1540;  flowbits: isset, FB314917_0; flowbits: unset, FB314917_0; flowbits: set, FB314917_1;  flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11001466; rev: 2;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,400, 1, relative;  byte_test: 2, <=,416, 1, relative; stream_size: server, <,3300; stream_size: client, <,2500;  flowbits: isset, FB314917_1; flowbits: unset, FB314917_1; flowbits: set, FB314917_2; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11001467; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #0"; flow: established, to_server; dsize: 8; stream_size: server, =,1; stream_size: client, <,10; flowbits: noalert;flowbits: set, FB145313_0; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001517; rev: 1;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #1"; flow: established, to_server; dsize: 1; stream_size: server, =,1; stream_size: client, <,11; flowbits: noalert; flowbits: isset, FB145313_0; flowbits: unset, FB145313_0; flowbits: set, FB145313_1; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001518; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #2"; flow: established, to_server; dsize: 2; stream_size: server, =,1; stream_size: client, <,13;  flowbits: noalert; flowbits: isset, FB145313_1; flowbits: unset, FB145313_1; flowbits: set, FB145313_2; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001519; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob pkt checker #3"; flow: established, to_server; dsize: 2; stream_size: server, =,1; stream_size: client, <,15;  flowbits: noalert; flowbits: isset, FB145313_2; flowbits: unset, FB145313_2; flowbits: set, FB145313_3; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001520; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Bayrob"; flow: established, to_server; dsize: 19; stream_size: server, <,21; stream_size: client, <,52; flowbits: isset, FB145313_3;  flowbits: unset, FB145313_3; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001521; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] AMMYY RAT pkt checker #0"; flow: established, to_server; content:"|3d|"; depth:1; dsize: 36; stream_size: server, =,1; stream_size: client, =,37; flowbits: noalert;flowbits: set, FB301822_0; classtype: misc-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001524; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] AMMYY RAT pkt checker #1"; flow: established, to_client; content:"|2d00|"; depth:2; dsize: 2; stream_size: server, <,5; stream_size: client, <,39; flowbits: isset, FB301822_0; flowbits: unset, FB301822_0; threshold: type limit, track by_src, count 1, seconds 30; classtype: misc-activity; metadata: created_at 2017_7_12; reference: url, github.com/ptresearch/AttackDetection; sid: 11001525; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #0"; flow: established, to_server; dsize: 4; stream_size: server, =,1; stream_size: client, =,5; content:"|7c0a|"; depth:4; fast_pattern; flowbits: set, FB117960_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001527; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #1"; flow: established, to_server; dsize: 27<>40; stream_size: server, =,1; stream_size: client, <,46; flowbits: isset, FB117960_0;  flowbits: unset, FB117960_0; flowbits: set, FB117960_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001528; rev: 2;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #2"; flow: established, to_client; dsize: 3; content:"|0d0a|"; fast_pattern; stream_size: server, >,0; stream_size: client, >,0; stream_size: server, <,5; stream_size: client, <,46; flowbits: isset, FB117960_1; flowbits: unset, FB117960_1; flowbits: set, FB117960_2; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001529; rev: 2;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat pkt checker #3"; flow: established, to_server; dsize: 1; content:"|0a|"; fast_pattern; depth:1; stream_size: server, >,0; stream_size: client, >,0; stream_size: server, <,5; stream_size: client, <,47; flowbits: isset, FB117960_2; flowbits: unset, FB117960_2; flowbits: set, FB117960_3; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001530; rev: 2;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Cybergate/Rebhip/Spyrat Backdoor"; flow: established, to_client; dsize: 69<>80; content:"|0d0a|"; fast_pattern; stream_size: server, >,0; stream_size: client, >,0; stream_size: server, <,200; stream_size: client, <,200; flowbits: isset, FB117960_3; flowbits: unset, FB117960_3; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11001531; rev: 2;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #0"; flow: established, to_server; content: "|1703 0100 20|"; fast_pattern; depth:5; content: "|1703 0100 20|"; distance:32; within: 5;  stream_size: server, >,1063; stream_size: client, >,429; stream_size: server, <,3156; stream_size: client, <,2261; flowbits: noalert; flowbits: isset, FB0_01; flowbits: set, FB167479_0; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001533; rev: 4;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert;flowbits: set, FB90331_0; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001535; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert; flowbits: isset, FB90331_0; flowbits: unset, FB90331_0; flowbits: set, FB90331_1; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001536; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #2"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert; flowbits: isset, FB90331_1; flowbits: unset, FB90331_1; flowbits: set, FB90331_2; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001537; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3116; stream_size: client, <,2089; flowbits: noalert; flowbits: isset, FB90331_2; flowbits: unset, FB90331_2; flowbits: set, FB90331_3; classtype: trojan-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001538; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3140; stream_size: client, <,2113; flowbits: isset, FB90331_3; flowbits: unset, FB90331_3; classtype: misc-activity; metadata: created_at 2017_7_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11001539; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #1"; flow: established, to_client; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,2523; stream_size: client, >,429; stream_size: server, <,4000; stream_size: client, <,2261; flowbits: noalert; flowbits: isset, FB167479_0; flowbits: unset, FB167479_0; flowbits: set, FB167479_1; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001540; rev: 3;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #2"; flow: established, to_server; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,3153; stream_size: client, >,1015; stream_size: server, <,4100; stream_size: client, <,2261;  flowbits: noalert;  flowbits: isset, FB167479_1; flowbits: unset, FB167479_1; flowbits: set, FB167479_2;  classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001541; rev: 4; ) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen) pkt checker #3"; flow: established, to_client; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,3739; stream_size: client, >,1601; stream_size: server, <,4856; stream_size: client, <,2261; flowbits: noalert;  flowbits: isset, FB167479_2; flowbits: unset, FB167479_2; flowbits: set, FB167479_3; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001542; rev: 3; ) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious TOR activity (Spy.Ursnif/Androm seen)"; flow: established, to_server; content: "|17 03 01 00 20|"; fast_pattern; depth:5; content: "|1703|"; distance:32; within: 2; stream_size: server, >,3739; stream_size: client, >,2187; stream_size: server, <,5000; stream_size: client, <,5000; flowbits: isset, FB167479_3; flowbits: unset, FB167479_3; classtype: trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11001543; rev: 3; ) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #0"; flow: established, to_server; dsize: 20; stream_size: server, =,1; stream_size: client, <,22; flowbits: noalert;flowbits: set, FB303766_0; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001554; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #1"; flow: established, to_server; dsize: 43; stream_size: server, =,1; stream_size: client, <,65; flowbits: noalert; flowbits: isset, FB303766_0; flowbits: unset, FB303766_0; flowbits: set, FB303766_1; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001555; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #2"; flow: established, to_server; dsize: 7; stream_size: server, =,1; stream_size: client, <,72; flowbits: noalert; flowbits: isset, FB303766_1; flowbits: unset, FB303766_1; flowbits: set, FB303766_2; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001556; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut"; flow: established, to_client; dsize: 105; stream_size: server, <,109; stream_size: client, <,82; flowbits: isset, FB303766_2; flowbits: unset, FB303766_2; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11001557; rev: 2;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #0"; flow: established, to_server; dsize: 89; stream_size: client, <,800; flowbits: noalert; flowbits: set, FB_Telegram_0; classtype: trojan-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001578; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #1"; flow: established, to_server; dsize: 89; stream_size: client, <,1500; flowbits: noalert; flowbits: isset, FB_Telegram_0; flowbits: unset, FB_Telegram_0; flowbits: set, FB_Telegram_1; classtype: trojan-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001579; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #2"; flow: established, to_server; dsize: 89; stream_size: client, <,2200; flowbits: noalert; flowbits: isset, FB_Telegram_1; flowbits: unset, FB_Telegram_1; flowbits: set, FB_Telegram_2; classtype: trojan-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001580; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger v1 pkt checker #3"; flow: established, to_server; dsize: 89; stream_size: client, <,2200; flowbits: noalert; flowbits: isset, FB_Telegram_2; flowbits: unset, FB_Telegram_2; flowbits: set, FB_Telegram_3; classtype: trojan-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001581; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET 443 (msg: "POLICY [PTsecurity] Telegram Messenger"; flow: established, to_server; dsize: 89; stream_size: client, <,2700; flowbits: isset, FB_Telegram_3; flowbits: unset, FB_Telegram_3; threshold: type limit, track by_src, count 1, seconds 300; classtype: misc-activity; metadata: created_at 2017_7_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11001582; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates pkt checker #0"; flow: established, to_server; dsize: 103<>106; stream_size: server, =,1; stream_size: client, <,107; flowbits: noalert;flowbits: set, FB79535_0; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001602; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates pkt checker #1"; flow: established, to_client; dsize: 20; stream_size: server, <,22; stream_size: client, <,107; flowbits: noalert; flowbits: isset, FB79535_0; flowbits: unset, FB79535_0; flowbits: set, FB79535_1; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001603; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates pkt checker #2"; flow: established, to_server; dsize: 39<>48; stream_size: server, <,22; stream_size: client, <,154; flowbits: noalert; flowbits: isset, FB79535_1; flowbits: unset, FB79535_1; flowbits: set, FB79535_2; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001604; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Linux/BillGates"; flow: established, to_client; dsize: 1<>9; stream_size: server, <,31; stream_size: client, <,155; flowbits: isset, FB79535_2; flowbits: unset, FB79535_2; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001605; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #0";flow: established, to_server; dsize: 20; stream_size: server, =,1; stream_size: client, <,22;flowbits: noalert; flowbits: set, FB309156_0;classtype: trojan-activity; metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001606;rev: 1;)

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut";flow: established, to_client;dsize: 68; stream_size: server, <,138;stream_size: client, <,137;flowbits: isset, FB309156_0;flowbits: unset, FB309156_0;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2017_7_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11001607;rev: 2;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3113; stream_size: client, <,404; flowbits: noalert; flowbits: set, FB251545_0; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001614; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,32, 1, relative; stream_size: server, <,3114; stream_size: client, <,404; flowbits: noalert; flowbits: isset, FB251545_0; flowbits: unset, FB251545_0; flowbits: set, FB251545_1; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001615; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #2"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; content: "|1703|"; distance:0; stream_size: server, <,3114; stream_size: client, <,404; flowbits: noalert; flowbits: isset, FB251545_1; flowbits: unset, FB251545_1; flowbits: set, FB251545_2; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001616; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt checker #3"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; stream_size: server, <,3114; stream_size: client, <,1704; flowbits: noalert; flowbits: isset, FB251545_2; flowbits: unset, FB251545_2; flowbits: set, FB251545_3; classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001617; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TorrentLocker TOR SSL pkt check #4"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, =,24, 1, relative; content: "|1703|"; distance:0; stream_size: server, <,3137; stream_size: client, <,2001; flowbits: isset, FB251545_3; flowbits: unset, FB251545_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2017_7_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11001618; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo-D SSL pkt checker #0.1"; flow: established, to_server; content: "|17 03 01 00 80|"; depth:5; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert;flowbits: set, FB313831_0; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001683; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #0.2"; flow: established, to_server; content: "|17 03 01 00 90|"; depth:5; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert;flowbits: set, FB313831_0; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001684; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,2512, 1, relative; byte_test: 2, <=,7900, 1, relative; stream_size: server, <,1905; stream_size: client, <,9911; stream_size: client, >,0; stream_size: server, >,0; flowbits: noalert; flowbits: isset, FB313831_0; flowbits: unset, FB313831_0; flowbits: set, FB313831_1; classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001685; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #2.1"; flow: established, to_client; content: "|17 03 01 01 60|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001686; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request pkt checker #0"; flow: established, to_client; content: "|1603 01|"; depth:3;  content:  "www.dropbox.com0";  distance:0; within: 2044; fast_pattern; stream_size: server, <,2045;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,300; flowbits: noalert; flowbits: set, FB309001_0; threshold: type limit, track by_src, count 1, seconds 30; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001732; rev: 1; ) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0100 80|"; depth:5; fast_pattern; content: !"|1703|";  distance:128;  within: 2; stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,514; flowbits: isset, FB309001_0; flowbits: unset, FB309001_0; flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001733; rev: 1;  )

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0100 90|"; depth:5; fast_pattern; content: !"|1703|"; distance:144; within: 2;  stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,1014;  flowbits: isset, FB309001_0;  flowbits: unset, FB309001_0;  flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001734; rev: 1; )

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0101 70|"; depth:5; fast_pattern; content: !"|1703|"; distance:368; within: 2;  stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,1014;  flowbits: isset, FB309001_0;  flowbits: unset, FB309001_0;  flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001735; rev: 1; )

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request";  flow: established, to_server;  content: "|1703 0102 00|";  depth:5; fast_pattern; content: !"|1703|"; distance:512; within: 2; stream_size: server, <,5891;stream_size: client, >,0; stream_size: server, >,0;  stream_size: client, <,1014; flowbits: isset, FB309001_0; flowbits: unset, FB309001_0; flowbits: set, FB309001_1;  classtype: misc-activity;  metadata: created_at 2017_8_8;  reference: url, github.com/ptresearch/AttackDetection; sid: 11001736;  rev: 1; )

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request 416  pkt checker #0"; flow: established, to_client; content: "|1603 01|"; depth:3;  content:  ".dl.dropboxusercontent.com0";  distance:0; within: 2044; fast_pattern; stream_size: server, <,2045;stream_size: client, >,0; stream_size: server, >,0; stream_size: client, <,300;  flowbits: noalert; flowbits: set, FB309001_0; threshold: type limit, track by_src, count 1, seconds 30; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001737; rev: 1; ) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "SUSPICIOUS [PTsecurity] Dropbox SSL Payload Request"; flow: established, to_server; content: "|1703 0101 A0|"; depth:5; fast_pattern; flowbits: isset, FB309001_0;  flowbits: unset, FB309001_0;  flowbits: set, FB309001_1; classtype: misc-activity; metadata: created_at 2017_8_8; reference: url, github.com/ptresearch/AttackDetection; sid: 11001738; rev: 1;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Agent/Trickbot/Gen-Upatre/Dyre/Dridex pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,160, 1, relative; byte_test: 2, <=,240, 1, relative; stream_size: server, <,3000; stream_size: client, <,3000; flowbits: noalert; flowbits: set, FB320221_0; classtype: trojan-activity; metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11001758; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Agent/Trickbot/Gen-Upatre/Dyre/Dridex pkt checker #2";flow: established, to_client;content: "|17 03 01 00 F0|";depth:5;content: "|17 03 01  00 20|";distance:240;within:5;content: "|17 03 01|";distance:32;within:3;stream_size: server, <,30000;stream_size: client, <,30000;flowbits: isset, FB320221_0; flowbits: unset, FB320221_0; flowbits: set, FB320221_1; flowbits: noalert ; classtype: trojan-activity;metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11001759;rev: 2;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Agent/Trickbot/Gen-Upatre/Dyre/Dridex #3";flow: established, to_client;content: "|17 03 01 01 00|"; depth:5; content: "|17 03 01  00 20|"; distance:256; within:5; content: "|17 03 01|";distance:32;within:3;stream_size: server, <,30000;stream_size: client, <,30000;flowbits: isset, FB320221_0; flowbits: unset, FB320221_0; flowbits: set, FB320221_1; classtype: trojan-activity;metadata: created_at 2017_8_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11001760;rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT pkt checker #0";flow: established, to_client;dsize: 4;content: "|FF|";offset:1;depth:1;stream_size: server, >,0;stream_size: server, <,30;stream_size: client, >,0;stream_size: client, <,160; flowbits: noalert; flowbits: set, FB322496_0;classtype: trojan-activity;metadata: created_at 2017_8_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11001783;rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Babylon RAT pkt checker #1";flow: established, to_client;dsize: 8;content: "|FF|";offset:1;depth:1;stream_size: server, >,8;stream_size: server, <,130;stream_size: client, >,160;stream_size: client, <,300; flowbits: noalert; flowbits: isset, FB322496_0; flowbits: set, FB322496_1; flowbits: unset, FB322496_0; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2017_8_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11001784;rev: 1;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Babylon RAT C2 conversation pkt checker #2";  flow: established, to_server;  dsize: 4;  content: "|FF|"; offset:1; depth:1;  stream_size: server, >,26;  stream_size: server, <,100;  stream_size: client, >,246;  stream_size: client, <,500;  flowbits: isset, FB322496_1;  flowbits: unset, FB322496_1;  classtype: trojan-activity;  metadata: created_at 2017_8_15;  reference: url, github.com/ptresearch/AttackDetection; sid: 11001785;  rev: 1; )  

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL pkt checker #2.2"; flow: established, to_client; content: "|17 03 01 00 D0|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001792; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dridex/Feodo SSL"; flow: established, to_client; content: "|17 03 01 00 C0|"; depth:5; stream_size: server, <,2257; stream_size: client, <,10263; stream_size: client, >,0; stream_size: server, >,0; flowbits: isset, FB313831_1; flowbits: unset, FB313831_1; threshold: type limit, track by_src, count 1, seconds 300;classtype: trojan-activity; metadata: created_at 2017_8_1; reference: url, github.com/ptresearch/AttackDetection; sid: 11001793; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 30|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: set, FB0_0; flowbits: isset, FB0_01; flowbits: noalert; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001842; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 40|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: set, FB0_0; flowbits: isset, FB0_01; flowbits: noalert; classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001843; rev: 1;) 

#alert tls  $EXTERNAL_NET any -> $HOME_NET any ( msg: "POLICY [PTsecurity] TOR cert set";  flow: established, to_client;  content: "|3082|"; depth: 300; content: "|308201|"; distance:2; within:3; content: "|a00302010202|"; distance:1; within:6; content: "|7777|"; distance:38; within:2; fast_pattern; flowbits: set, FB0_01; flowbits: noalert; classtype: misc-activity;  metadata: created_at 2017_8_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11001844;  rev: 2; )

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; content:"|02 40|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_2; flowbits: unset, FB0_2; flowbits: set, FB0_3; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001845; rev: 3;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; content:"|02 30|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: isset, FB0_2; flowbits: unset, FB0_2; flowbits: set, FB0_3; flowbits: noalert;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11001846; rev: 3;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #0"; flow: established, to_server; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,2; stream_size: client, >,0; stream_size: client, <,6; flowbits: noalert;flowbits: set, FB206141_0; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001881; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #1"; flow: established, to_server; dsize: 4;  content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,2; stream_size: client, >,0; stream_size: client, <,10; flowbits: noalert; flowbits: isset, FB206141_0; flowbits: unset, FB206141_0; flowbits: set, FB206141_1; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001882; rev: 1;) 

#alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #2"; flow: established, to_client; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,6; stream_size: client, >,0; stream_size: client, <,10; flowbits: noalert; flowbits: isset, FB206141_1; flowbits: unset, FB206141_1; flowbits: set, FB206141_2; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001883; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET !$HTTP_PORTS (msg: "MALWARE [PTsecurity] RemoteAdmin.RemoteUtilities pkt checker #3"; flow: established, to_server; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,6; stream_size: client, >,0; stream_size: client, <,14; flowbits: noalert; flowbits: isset, FB206141_2; flowbits: unset, FB206141_2; flowbits: set, FB206141_3; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001884; rev: 1;) 

#alert tcp $EXTERNAL_NET !$HTTP_PORTS -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/RemoteAdmin.RemoteUtilities pkt checker #4"; flow: established, to_client; dsize: 4; content: "|0000|"; depth:2; stream_size: server, >,0; stream_size: server, <,14; stream_size: client, >,0; stream_size: client, <,22; flowbits: isset, FB206141_3; flowbits: unset, FB206141_3; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_8_29; reference: url, github.com/ptresearch/AttackDetection; sid: 11001885; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC) cert"; flow: established, to_client; content: "|3082|"; depth:300; content: "|a00302010202|"; distance:6; within:6; fast_pattern; flowbits: set, FB346039_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_9_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11001978; rev: 1;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC) #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|00A0|"; distance:1; within:2; fast_pattern; stream_size: server, >,4868; stream_size: server, <,5949; stream_size: client, >,424; stream_size: client, <,685; flowbits: isset, FB346039_0; flowbits: unset, FB346039_0; flowbits: set, FB346039_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001979; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC) #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|00B0|"; distance:1; within:2; fast_pattern; stream_size: client, >,424; stream_size: client, <,685; flowbits: isset, FB346039_0; flowbits: unset, FB346039_0; flowbits: set, FB346039_1; flowbits: set, FB346039_2; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001980; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC)"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0140|"; distance:1; within:2;  content: "|1703|"; distance: 320; within:2; content: "|04A0|"; distance:1; within:2; fast_pattern; stream_size: server, >,5000; stream_size: server, <,10069; stream_size: client, >,424; stream_size: client, <,905; flowbits: isset, FB346039_1; flowbits: unset, FB346039_1; flowbits: unset, FB346039_2; flowbits: set, FB346039_3; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001981; rev: 1;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC)"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0200|"; distance:1; within:2; fast_pattern; stream_size: server, >,5000; stream_size: server, <,6500; stream_size: client, >,424; stream_size: client, <,905; flowbits: isset, FB346039_2; flowbits: unset, FB346039_2; classtype: trojan-activity; metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001983; rev: 1;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Formbook/Upatre Downloader CnC)";flow: established, to_client;content: "|1703|"; depth:2;content: "|0170|"; distance:1; within:2; fast_pattern;stream_size: server, >,5000;stream_size: server, <,12500;stream_size: client, >,424;stream_size: client, <,905;flowbits: isset, FB346039_2;flowbits: unset, FB346039_2;classtype: trojan-activity;metadata: created_at 2017_9_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11001984; rev: 2;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #1"; flow: established, to_client; dsize: 907; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,200; content: "|1603|"; depth:2; flowbits: noalert; flowbits: set, FB363347_1; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002070; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #2"; flow: established, to_server; dsize: 326; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,500; content: "|1603|"; depth:2; flowbits: noalert; flowbits: isset, FB363347_1; flowbits: unset, FB363347_1; flowbits: set, FB363347_2; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002071; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #3"; flow: established, to_client; dsize: 6; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,500; content: "|1403|"; depth:2; flowbits: noalert; flowbits: isset, FB363347_2; flowbits: unset, FB363347_2; flowbits: set, FB363347_3; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002072; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike pkt checker #4"; flow: established, to_client; dsize: 53; stream_size: server, >,800; stream_size: server, <,1200; stream_size: client, >,100; stream_size: client, <,500; content: "|1603|"; depth:2; flowbits: noalert; flowbits: isset, FB363347_3; flowbits: unset, FB363347_3; flowbits: set, FB363347_4; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002073; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Suspicious SSL connection - Observed in Cobalt Strike"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,128, 1, relative; byte_test: 2, <=,200, 1, relative; stream_size: server, >,800; stream_size: server, <,3019; stream_size: client, >,100; stream_size: client, <,1318; flowbits: isset, FB363347_4; flowbits: unset, FB363347_4; flowbits: set, FB363347_5; classtype: trojan-activity; metadata: created_at 2017_10_15; reference: url, github.com/ptresearch/AttackDetection; sid: 11002074; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Observed Malicious SSL Certificate (Orcus RAT)";flow: established, to_client;content: "|a003 0201 0202 10|";depth:600;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; flowbits: noalert; flowbits: set, FB369639_;metadata: created_at 2017_10_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11002134;rev: 2;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Orcus RAT) pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0020|"; distance:1; within:2; fast_pattern; stream_size: server, <,999; stream_size: server, >,1; stream_size: client, >,250; stream_size: client, <,355; flowbits: noalert; flowbits: isset, FB369639_; flowbits: unset, FB369639_; flowbits: set, FB369639_0; classtype: trojan-activity; metadata: created_at 2017_10_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11002135; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious SSL connection (Orcus RAT)";flow: established, to_server;content: "|1703|"; depth:2;content: "|0020|"; distance:1; within:2; fast_pattern;stream_size: server, <,1200;stream_size: server, >,700;stream_size: client, >,200;stream_size: client, <,600;flowbits: isset, FB369639_0;flowbits: unset, FB369639_0;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2017_10_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11002136; rev: 2;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "POLICY [PTsecurity] TOR SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content:"|00 23|"; distance:1; within:2; fast_pattern; stream_size: server, <,40000; stream_size: client, <,40000; stream_size: server, >,0; stream_size: client, >,0; flowbits: noalert; flowbits: set, FB0_0; flowbits: isset, FB0_01;  classtype: misc-activity; metadata: created_at 2017_7_6; reference: url, github.com/ptresearch/AttackDetection; sid: 11002145; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] RevCode SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0110|"; distance:1; within:2; fast_pattern;stream_size: server, >,1310; stream_size: server, <,7014; stream_size: client, >,433; stream_size: client, <,1460; flowbits: noalert; flowbits: set, FB375151_0; classtype: trojan-activity; metadata: created_at 2017_10_27; reference: url, github.com/ptresearch/AttackDetection; sid: 11002165; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] RevCode SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|00D0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1310; stream_size: server, <,7014; stream_size: client, >,646; stream_size: client, <,1460; flowbits: noalert; flowbits: isset, FB375151_0; flowbits: unset, FB375151_0; flowbits: set, FB375151_1; classtype: trojan-activity; metadata: created_at 2017_10_27; reference: url, github.com/ptresearch/AttackDetection; sid: 11002166; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] RevCode SSL connection pkt checker #2"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0180|"; distance:1; within:2; fast_pattern;stream_size: server, >,1599; stream_size: server, <,7014; stream_size: client, >,646; stream_size: client, <,1560; flowbits: isset, FB375151_1; flowbits: unset, FB375151_1; flowbits: set, FB375151_2; classtype: trojan-activity; metadata: created_at 2017_10_27; reference: url, github.com/ptresearch/AttackDetection; sid: 11002167; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif.BK SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0130|"; distance:1; within:2; fast_pattern;stream_size: server, >,928; stream_size: server, <,1998; stream_size: client, >,662; stream_size: client, <,1540; flowbits: set, FB391441_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_11_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002231; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif.BK SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,320, 1, relative; byte_test: 2, <=,336, 1, relative; stream_size: server, >,928; stream_size: server, <,1998; stream_size: client, >,1003; stream_size: client, <,1540;  flowbits: isset, FB391441_0; flowbits: unset, FB391441_0; flowbits: set, FB391441_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_11_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002232; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif.BK SSL connection"; flow: established, to_client; content: "|1703|"; depth:2; content: "|01B0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1365; stream_size: server, <,2430; stream_size: client, >,1003; stream_size: client, <,1972; flowbits: isset, FB391441_1; flowbits: unset, FB391441_1; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2017_11_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002233; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #0"; flow: established, to_server; dsize: 20; stream_size: server, =,1; stream_size: client, <,22; flowbits: set, FB303766_0; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002261; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #1"; flow: established, to_server; dsize: 40; stream_size: server, =,1; stream_size: client, <,65;  flowbits: isset, FB303766_0; flowbits: unset, FB303766_0; flowbits: set, FB303766_1; flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002262; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut pkt checker #2"; flow: established, to_client; dsize: 300<>400; stream_size: server, <,409; stream_size: client, <,82; flowbits: isset, FB303766_1;  flowbits: unset, FB303766_1; flowbits: set, FB303766_2; flowbits: noalert; threshold: type limit, track by_src, count 1, seconds 30; classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002263; rev: 1;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdor.W32/Virut"; flow: established, to_server; dsize: <13; stream_size: server, <,400; stream_size: client, <,90;  flowbits: isset, FB303766_2; flowbits: unset, FB303766_2;  classtype: trojan-activity; metadata: created_at 2017_7_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002264; rev: 2;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] APT28 Uploader SSL connection pkt checker #0.1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0170|"; distance:1; within:2; fast_pattern;stream_size: server, >,998; stream_size: server, <,1700; stream_size: client, >,722; stream_size: client, <,18767; flowbits: noalert;flowbits: set, FB424249_0; classtype: trojan-activity; metadata: created_at 2017_12_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002276; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] APT28 Uploader SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|3FF0|"; distance:1; within:2; fast_pattern;stream_size: server, >,998; stream_size: server, <,16469; stream_size: client, >,2182; stream_size: client, <,35135; flowbits: isset, FB424249_0; flowbits: unset, FB424249_0; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2017_12_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002277; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] APT28 Uploader SSL connection pkt checker #0.2"; flow: established, to_server; content: "|1703|"; depth:2; content: "|01a0|"; distance:1; within:2; fast_pattern;stream_size: server, >,998; stream_size: server, <,1700; stream_size: client, >,722; stream_size: client, <,18767; flowbits: noalert;flowbits: set, FB424249_0; classtype: trojan-activity; metadata: created_at 2017_12_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002278; rev: 1;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #0"; flow: established, to_server; content: "|17030300AB|"; depth:5; fast_pattern; stream_size: server, >,2757; stream_size: server, <,4534; stream_size: client, >,390; stream_size: client, <,1123; flowbits: noalert; flowbits: set, FB405091_0; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002279; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,220, 1, relative; byte_test: 2, <=,245, 1, relative; stream_size: server, >,3434; stream_size: server, <,4534; stream_size: client, >,390; stream_size: client, <,1123;  flowbits: noalert; flowbits: isset, FB405091_0; flowbits: unset, FB405091_0; flowbits: set, FB405091_1; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002280; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #2"; flow: established, to_server; content: "|17030300AB|"; depth:5; fast_pattern; stream_size: server, >,3434; stream_size: server, <,4534; stream_size: client, >,566; stream_size: client, <,1123;  flowbits: noalert; flowbits: isset, FB405091_1; flowbits: unset, FB405091_1; flowbits: set, FB405091_2; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002281; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,220, 1, relative; byte_test: 2, <=,245, 1, relative; stream_size: server, >,4112; stream_size: server, <,4534; stream_size: client, >,566; stream_size: client, <,1123;  flowbits: noalert; flowbits: isset, FB405091_2; flowbits: unset, FB405091_2; flowbits: set, FB405091_3; classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002282; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] W97M.Cerber/Shurl0ckr TOR connection pkt checker #4"; flow: established, to_server; content: "|17030300AB|"; depth:5; fast_pattern; stream_size: server, >,4112; stream_size: server, <,5305; stream_size: client, >,742; stream_size: client, <,1294; flowbits: isset, FB405091_3; flowbits: unset, FB405091_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_1_25; reference: url, github.com/ptresearch/AttackDetection; sid: 11002283; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #0"; flow: established, to_server; content: "|1703 01 0020|"; depth:5; fast_pattern;stream_size: server, >,954; stream_size: server, <,3863; stream_size: client, >,166; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB0_01; flowbits: set, FB447357_0; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002430; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #1"; flow: established, to_client; content: "|1703 01 0020|"; depth:5;  fast_pattern; content: "|1703|"; distance:32; within:2; stream_size: server, >,2414; stream_size: server, <,3863; stream_size: client, >,166; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB447357_0; flowbits: unset, FB447357_0; flowbits: set, FB447357_1; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002431; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #2"; flow: established, to_server; content: "|1703 01 0220|"; depth:5;  fast_pattern;stream_size: server, >,3044; stream_size: server, <,3863; stream_size: client, >,715; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB447357_1; flowbits: unset, FB447357_1; flowbits: set, FB447357_2; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002432; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity pkt checker #3"; flow: established, to_client; content: "|1703 01 0020|"; depth:5;  fast_pattern;content: "|1703|"; distance:32; within:2; stream_size: server, >,3630; stream_size: server, <,3863; stream_size: client, >,1264; stream_size: client, <,2558; flowbits: noalert; flowbits: isset, FB447357_2; flowbits: unset, FB447357_2; flowbits: set, FB447357_3; classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002433; rev: 1;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Spy.Ursnif SSL TOR activity"; flow: established, to_server; content: "|1703 01 0220|"; depth:5;  fast_pattern;stream_size: server, >,3630; stream_size: server, <,4407; stream_size: client, >,1813; stream_size: client, <,3102; flowbits: isset, FB447357_3; flowbits: unset, FB447357_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_1_17; reference: url, github.com/ptresearch/AttackDetection; sid: 11002434; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif Malicious SSL Connection Detected pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0130|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,2772; stream_size: client, >,630; stream_size: client, <,1540; flowbits: noalert; flowbits: isset, FB449906_; flowbits: set, FB449906_0; classtype: trojan-activity; metadata: created_at 2018_1_18; reference: url, github.com/ptresearch/AttackDetection; sid: 11002450; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif Malicious SSL Connection Detected pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0160|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,2772; stream_size: client, >,987; stream_size: client, <,1540; flowbits: noalert; flowbits: isset, FB449906_0; flowbits: unset, FB449906_0; flowbits: set, FB449906_1; classtype: trojan-activity; metadata: created_at 2018_1_18; reference: url, github.com/ptresearch/AttackDetection; sid: 11002451; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ursnif Malicious SSL Connection Detected"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,352, 1, relative; byte_test: 2, <=,816, 1, relative; stream_size: server, >,1291; stream_size: server, <,3588; stream_size: client, >,987; stream_size: client, <,2356; flowbits: isset, FB449906_1; flowbits: unset, FB449906_1; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_1_18; reference: url, github.com/ptresearch/AttackDetection; sid: 11002452; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] Ursnif Malicious SSL detect pkt checker #0";flow:established,from_server; content:"|09 00 C1 0E 3F 17 BC 2F BE 83|"; depth: 300; content:"|55 04 08|"; distance:0; content:"|0A|Some-State"; distance:1; within:11; content:"|55 04 0A|"; distance:0; content:"|18|Internet Widgits Pty Ltd"; distance:1; within:25; fast_pattern; flowbits: set, FB449906_; flowbits: noalert; reference:md5,65dae76418fa23277068a00e6a0199d; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11002454; rev:1; metadata:attack_target Client_Endpoint, deployment Perimeter,tag SSL_Malicious_Cert, signature_severity Major, created_at 2018_01_18;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #0"; flow: established, to_server; content: "|17030100D0|"; depth:15; fast_pattern; stream_size: server, >,4561; stream_size: server, <,5925; stream_size: client, >,559; stream_size: client, <,1794; flowbits: noalert;flowbits: set, FB507762_0; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002647; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #1"; flow: established, to_client; content: "|1703010160|"; depth:15; fast_pattern; stream_size: server, >,4950; stream_size: server, <,5925; stream_size: client, >,559; stream_size: client, <,1794; flowbits: noalert; flowbits: isset, FB507762_0; flowbits: unset, FB507762_0; flowbits: set, FB507762_1; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002648; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #2"; flow: established, to_server; content: "|17030100D0|"; depth:15; fast_pattern; stream_size: server, >,4950; stream_size: server, <,5925; stream_size: client, >,788; stream_size: client, <,1794; flowbits: noalert; flowbits: isset, FB507762_1; flowbits: unset, FB507762_1; flowbits: set, FB507762_2; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002649; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Malicious redirect SSL (urlz.fr) pkt checker #3"; flow: established, to_client; content: "|1703010160|"; depth:15; fast_pattern; stream_size: server, >,5307; stream_size: server, <,5925; stream_size: client, >,788; stream_size: client, <,1794; flowbits: isset, FB507762_2; flowbits: unset, FB507762_2; flowbits: set, FB507762_3; classtype: trojan-activity; metadata: created_at 2018_3_7; reference: url, github.com/ptresearch/AttackDetection; sid: 11002650; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Shifr/Shurl0cker Ransomware SSL connection pkt checker #0";flow: established, to_client;content: "|17 03 03 00 40|"; depth:5; fast_pattern;stream_size: server, >,3407; stream_size: server, <,3679; stream_size: client, >,290; stream_size: client, <,672;flowbits: isset,FB513376_;flowbits: set,FB513376_0;flowbits: unset,FB513376_;flowbits: noalert; classtype: trojan-activity;metadata: created_at 2018_3_9; reference: url, github.com/ptresearch/AttackDetection; sid: 11002659; rev: 1;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Shifr/Shurl0cker Ransomware SSL connection pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0058|"; distance:1; within:2; fast_pattern;stream_size: server, >,3407; stream_size: server, <,3679; stream_size: client, >,383; stream_size: client, <,672; flowbits: noalert; flowbits: isset, FB513376_0; flowbits: unset, FB513376_0; flowbits: set, FB513376_1; classtype: trojan-activity; metadata: created_at 2018_3_9; reference: url, github.com/ptresearch/AttackDetection; sid: 11002660; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Shifr/Shurl0cker Ransomware SSL connection pkt checker #2";flow: established, to_client;content: "|1703|"; depth:2;content: "|0021|"; distance:1; within:2; fast_pattern;stream_size: server, >,2000;stream_size: server, <,5000;stream_size: client, >,538;stream_size: client, <,705;flowbits: isset, FB513376_1;flowbits: unset, FB513376_1;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_3_9; reference: url, github.com/ptresearch/AttackDetection; sid: 11002661; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] Onion.casa SSL Certificate Observed"; content: "|30 3A 31 21 30 1F 06 0355 04 0B 13 18 44 6F 6D  61 69 6E 20 43 6F 6E 7472 6F 6C 20 56 61 6C 69  64 61 74 65 64 31 15 3013 06 03 55 04 03 0C 0C  2A 2E 6F 6E 69 6F 6E 2E63 61 73 61|"; flowbits: set,FB513376_; flowbits: noalert; classtype: policy-violation; metadata: created_at 2018_3_13; reference: url, github.com/ptresearch/AttackDetection; sid: 11002667;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #0"; flow: established, to_server; content: "|1703010020|"; depth:5; fast_pattern; content: "|1703|"; distance:32; within: 2; stream_size: server, >,1378; stream_size: server, <,3413; stream_size: client, >,419; stream_size: client, <,1488; flowbits: noalert;flowbits: set, FB550954_0; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002811; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; content: "|01A0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1799; stream_size: server, <,3413; stream_size: client, >,419; stream_size: client, <,1488; flowbits: noalert; flowbits: isset, FB550954_0; flowbits: unset, FB550954_0; flowbits: set, FB550954_1; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002812; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #2"; flow: established, to_server; content: "|1703010020|"; depth:5; fast_pattern; content: "|1703|"; distance:32; within: 2; stream_size: server, >,1799; stream_size: server, <,3413; stream_size: client, >,829; stream_size: client, <,1488; flowbits: noalert; flowbits: isset, FB550954_1; flowbits: unset, FB550954_1; flowbits: set, FB550954_2; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002813; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,656, 1, relative; byte_test: 2, <=,704, 1, relative; stream_size: server, >,2460; stream_size: server, <,3413; stream_size: client, >,829; stream_size: client, <,1488; flowbits: noalert; flowbits: isset, FB550954_2; flowbits: unset, FB550954_2; flowbits: set, FB550954_3; classtype: trojan-activity; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002814; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex TLSv1.0 connection pkt checker #4";flow: established, to_server; content: "|1703010020|"; depth:5; fast_pattern; content: "|1703|"; distance:32; within: 2; stream_size: server, >,2460;stream_size: server, <,3445;stream_size: client, >,1127;stream_size: client, <,1620;flowbits: isset, FB550954_3;flowbits: unset, FB550954_3;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002815; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #0"; flow: established, to_server; dsize: 512<>728; stream_size: server, =,1; stream_size: client, <,729; flowbits: noalert; flowbits: set, FB550953_0; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002816; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #1"; flow: established, to_client; dsize: 73; stream_size: server, =,74; stream_size: client, >,511; stream_size: client, <,729; flowbits: noalert; flowbits: isset, FB550953_0; flowbits: unset, FB550953_0; flowbits: set, FB550953_1; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002817; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #2"; flow: established, to_client; dsize: 34; stream_size: server, =,108; stream_size: client, >,511; stream_size: client, <,729; flowbits: noalert; flowbits: isset, FB550953_1; flowbits: unset, FB550953_1; flowbits: set, FB550953_2; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002818; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #3"; flow: established, to_client; dsize: 62; stream_size: server, =,170; stream_size: client, >,511; stream_size: client, <,729; flowbits: noalert; flowbits: isset, FB550953_2; flowbits: unset, FB550953_2; flowbits: set, FB550953_3; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002819; rev: 1;)

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] LanternVPN connection pkt checker #4"; flow: established, to_client; dsize: 40; stream_size: server, =,210; stream_size: client, >,511; stream_size: client, <,729; flowbits: isset, FB550953_3; flowbits: unset, FB550953_3; classtype: policy-violation; metadata: created_at 2018_4_14; reference: url, github.com/ptresearch/AttackDetection; sid: 11002820; rev: 1;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection cert";flow: established, to_client;content: "|308203|";depth: 600;content: "|308202|";distance:1;within:3;content: "|a003020102020900|";distance:1;within:8;flowbits: noalert; flowbits: set, FB566923_;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_5_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002938; rev: 1;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,240, 1, relative; byte_test: 2, <=,288, 1, relative; stream_size: server, >,1278; stream_size: server, <,3797; stream_size: client, >,374; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_; flowbits: unset, FB566923_; flowbits: set, FB566923_0; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002939; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #1"; flow: established, to_client; content: "|1703|"; depth:2; content: "|01A0|"; distance:1; within:2; fast_pattern;stream_size: server, >,1699; stream_size: server, <,3797; stream_size: client, >,374; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_0; flowbits: unset, FB566923_0; flowbits: set, FB566923_1; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002940; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #2"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,368, 1, relative; byte_test: 2, <=,416, 1, relative; stream_size: server, >,1699; stream_size: server, <,3797; stream_size: client, >,747; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_1; flowbits: unset, FB566923_1; flowbits: set, FB566923_2; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002941; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection pkt checker #3"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,704, 1, relative; byte_test: 2, <=,896, 1, relative; stream_size: server, >,2488; stream_size: server, <,3797; stream_size: client, >,747; stream_size: client, <,1657; flowbits: noalert; flowbits: isset, FB566923_2; flowbits: unset, FB566923_2; flowbits: set, FB566923_3; classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002942; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] TrickBot.Spy SSL connection"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,256, 1, relative; byte_test: 2, <=,304, 1, relative; stream_size: server, >,2488; stream_size: server, <,4101; stream_size: client, >,1008; stream_size: client, <,1961; flowbits: isset, FB566923_3; flowbits: unset, FB566923_3; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_05_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11002943; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32.Backdoor.Zegost.Auto connection pkt checker #0";flow: established, to_server; dsize: 473;stream_size: server, =,1;stream_size: client, =,474;pcre:"/[\x0e-\x19\x80-\xff]{5}/";flowbits: noalert;flowbits: set, FB582249_0;classtype: trojan-activity;metadata: created_at 2018_05_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11003000; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32.Backdoor.Zegost.Auto connection";flow: established, to_client; dsize: 18;stream_size: server, =,19;stream_size: client, =,474;flowbits: isset, FB582249_0;flowbits: unset, FB582249_0;classtype: trojan-activity;metadata: created_at 2018_05_23; reference: url, github.com/ptresearch/AttackDetection; sid: 11003001; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ozone RAT connection pkt#0";flow: established, to_server; dsize: 6;content: "|0000 00|";fast_pattern;offset:2;depth: 3;content:"|01|";offset:0;depth:1;byte_test:1,>,0x06,1;byte_test:1,<,0xf0,1;stream_size: server, =,1;stream_size: client, =,7;flowbits: noalert;flowbits: set, FB582528_0;classtype: trojan-activity;metadata: created_at 2018_05_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11003004; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ozone RAT connection";flow: established, to_client;dsize: 6;stream_size: server, >,0;stream_size: server, <,54;stream_size: client, >,0;stream_size: client, <,650;content: "|0100 0000|";fast_pattern; depth: 4;flowbits: isset, FB582528_0;flowbits: unset, FB582528_0;classtype: trojan-activity;metadata: created_at 2018_05_24; reference: url, github.com/ptresearch/AttackDetection; sid: 11003005; rev: 1;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL certificate";flow: established, to_client;content: "Some-State1";depth:300;fast_pattern;flowbits: set, FB625629_;flowbits: noalert;threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity;metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003532; rev: 1;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL certificate pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0140|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,1844; stream_size: client, >,646; stream_size: client, <,1492;  flowbits: isset, FB625629_; flowbits: unset, FB625629_; flowbits: noalert; flowbits: set, FB625629_0; classtype: trojan-activity; metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003533; rev: 1;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL certificate pkt checker #1"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0140|"; distance:1; within:2; fast_pattern;stream_size: server, >,934; stream_size: server, <,1844; stream_size: client, >,971; stream_size: client, <,1492;  flowbits: isset, FB625629_0; flowbits: unset, FB625629_0; flowbits: noalert; flowbits: set, FB625629_1; classtype: trojan-activity; metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003534; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Ursnif/Gozi SSL connection"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0160|"; distance:1; within:2; fast_pattern;stream_size: server, >,1291; stream_size: server, <,2196; stream_size: client, >,971; stream_size: client, <,1844; flowbits: isset, FB625629_1; flowbits: unset, FB625629_1; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_08_19; reference: url, github.com/ptresearch/AttackDetection; sid: 11003535; rev: 1;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Possible Observed Malicious SSL Cert (APT32)"; flow: established, to_client; content: "|300d06092a864886f70d01010b0500304a310b300906035504061302555331163014060355040a130d4c6574277320456e6372797074312330210603550403131a4c6574277320456e637279707420417574686f72697479205833301e170d313830|"; depth:300; flowbits: noalert; flowbits: set, FB658819_;classtype: trojan-activity; metadata: created_at 2018_8_21; reference: url, github.com/ptresearch/AttackDetection; sid: 11003554; rev: 1;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Possible Observed Malicious SSL Cert (APT32)pkt checker #0"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0150|"; distance:1; within:2; fast_pattern;stream_size: server, >,2793; stream_size: server, <,21028; stream_size: client, >,603; stream_size: client, <,1236; flowbits: noalert; flowbits: isset, FB658819_; flowbits: unset, FB658819_; flowbits: set, FB658819_0; classtype: trojan-activity; metadata: created_at 2018_08_21; reference: url, github.com/ptresearch/AttackDetection; sid: 11003555; rev: 1;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Possible Observed Malicious SSL Connection (APT32)"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0090|"; distance:1; within:2; fast_pattern; stream_size: server, >,2942; stream_size: server, <,37492; stream_size: client, >,603; stream_size: client, <,17700; flowbits: isset, FB658819_0; flowbits: unset, FB658819_0; threshold: type limit, track by_src, count 1, seconds 30;classtype: trojan-activity; metadata: created_at 2018_08_21; reference: url, github.com/ptresearch/AttackDetection; sid: 11003556; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Lethic.AF connection pkt checker #0";flow: established, to_client; dsize: 5;stream_size: server, <,40;stream_size: client, <,20;content: "|0000 0000 06|"; depth: 6; flowbits: noalert; flowbits: set, FB663513_0;classtype: trojan-activity;metadata: created_at 2018_08_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11003608; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Win32/Lethic.AF connection pkt checker #1";flow: established, to_client; dsize: 11;stream_size: server, <,40;stream_size: client, <,20;content: "|0001|"; offset: 3; depth: 2; flowbits: noalert; flowbits: isset, FB663513_0;flowbits: unset, FB663513_0;flowbits: set, FB663513_1;classtype: trojan-activity;metadata: created_at 2018_08_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11003609; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Win32/Lethic.AF";flow: established, to_server; dsize: 6;stream_size: server, <,40;stream_size: client, <,26;content: "|0021|"; offset: 3; depth: 2;flowbits: isset, FB663513_1;flowbits: unset, FB663513_1;classtype: trojan-activity;metadata: created_at 2018_08_26; reference: url, github.com/ptresearch/AttackDetection; sid: 11003610; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 0";flow:established, to_server; dsize:200<>910;stream_size:client,>,200;stream_size:client, <,911;stream_size:server,=,1;flowbits:set,FB180732_0; flowbits: noalert; metadata: former_category TROJAN;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003611; rev:6;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2017_10_12;)

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 1"; flow:established, to_client; dsize:25<>35; stream_size:server,<,35; stream_size:server,>,25; stream_size:client,>,200; stream_size:client,<,911; flowbits:isset,FB180732_0; flowbits:unset, FB180732_0; flowbits:set,FB180732_1; flowbits: noalert; metadata: former_category TROJAN; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003612; rev:6; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2017_10_12;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 2"; flow:established, to_server; dsize:42<>270; stream_size:server, <,35;stream_size:server, >,25; stream_size:client, >,246; stream_size:client, <,1210; flowbits:isset, FB180732_1; flowbits:unset,FB180732_1; flowbits:set,FB180732_2; flowbits: noalert; metadata: former_category TROJAN;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003613; rev:10;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Significant, updated_at 2018_04_11;)

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"MALWARE [PTsecurity] REMCOS pkt checker 3"; flow:established, to_client; dsize:25<>200; stream_size:server, <,200; stream_size:server, >,50; stream_size:client, <,1220; stream_size:client, >,200; flowbits:isset, FB180732_2; flowbits:unset, FB180732_2; flowbits:set, FB180732_3; flowbits: noalert; metadata: former_category TROJAN; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003614; rev:7; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2017_10_12;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg:"MALWARE [PTsecurity] Backdoor.Win32/Remcos RAT connection";flow:established, to_server;dsize:44<>270;stream_size:server,<,200;stream_size:server,>,50;stream_size:client,<,1400;stream_size:client,>,200;flowbits:isset,FB180732_3;flowbits:unset,FB180732_3; threshold:type limit,track by_src,count 1, seconds 30;metadata: former_category TROJAN; reference:url,blog.fortinet.com/2017/02/14/remcos-a-new-rat-in-the-wild-2;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11003615;rev:8;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_11, malware_family Remcos, performance_impact Moderate, updated_at 2018_04_11;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] GandCrab v.5 SSL Cert";flow: established, to_client;content: "|3082|";depth: 600;content: "Let's Encrypt1"; distance: 0;flowbits: noalert;flowbits: set, FB709724_;classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003915; rev: 2;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] GandCrab v.5 SSL Connection";flow: established, to_server;content: "|1703 01 0340|"; depth:5;stream_size: server, <,3923;stream_size: client, <,2001;flowbits: isset, FB709724_;flowbits: unset, FB709724_;flowbits: set, FB709724_0; flowbits: noalert; classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003916; rev: 2;)

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] GandCrab v.5 SSL Connection";flow: established, to_client;content: "|1703 01 0140|"; depth:5;stream_size: server, <,4723;stream_size: client, <,3501;flowbits: isset, FB709724_0;flowbits: unset, FB709724_0;classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003917; rev: 1;)

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Trojan.Ranapama.JH pkt checker #0"; flow: established, to_server; dsize: 51<>58;stream_size: server, =,1;stream_size: client, >,0;stream_size: client, <,58; pcre: "/^(?:[\x1f-\x80])+$/"; flowbits: noalert; flowbits: set, FB710046_0; classtype: trojan-activity; metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003921; rev: 1;) 

#alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Trojan.Ranapama.JH pkt checker #1";flow: established, to_client; dsize: 3;stream_size: server, =,4;stream_size: client, >,51;stream_size: client, <,58; pcre: "/^(?:[\x1f-\x80])+$/"; flowbits: noalert; flowbits: isset, FB710046_0;flowbits: unset, FB710046_0;flowbits: set, FB710046_1;classtype: trojan-activity;metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003922; rev: 1;) 

#alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Trojan.Ranapama.JH"; flow: established, to_server; dsize: 2; stream_size: server, =,4; stream_size: client, >,53; stream_size: client, <,62; pcre: "/^(?:[\x1f-\x80])+$/"; flowbits: isset, FB710046_1; flowbits: unset, FB710046_1; classtype: trojan-activity; metadata: created_at 2018_10_11; reference: url, github.com/ptresearch/AttackDetection; sid: 11003923; rev: 1;) 

alert tls any any -> any any (msg: "MALWARE [PTsecurity] Silent Trinity pkt checker #0"; flow: established, to_client; stream_size: client, <,3500; stream_size: server, <,3500; content: "|1703030065|"; depth: 5; flowbits: set, ST_checker1; flowbits: noalert; reference: url, github.com/ptresearch/AttackDetection; classtype: trojan-activity; sid: 11004397; rev: 2;)

alert tls any any -> any any (msg: "MALWARE [PTsecurity] Silent Trinity pkt checker #1"; flow: established, to_client; stream_size: client, <,3500; stream_size: server, <,3500; content: "|1703030099|"; depth: 5; flowbits: isset, ST_checker1; flowbits: set, ST_checker2; flowbits: unset, ST_checker1; flowbits: noalert; reference: url, github.com/ptresearch/AttackDetection; classtype: trojan-activity; sid: 11004398; rev: 2;)

alert tls any any -> any any (msg: "MALWARE [PTsecurity] Silent Trinity RAT (post-exploitation agent)"; flow: established, to_client; stream_size: client, <,3500; stream_size: server, <,3500; content: "|17030300a0|"; depth: 5; flowbits: isset, ST_checker2; flowbits: unset, ST_checker2; reference: url, github.com/ptresearch/AttackDetection; classtype: trojan-activity; sid: 11004399; rev: 2;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "APP [PTsecurity] MTproto Telegram pkt chk#0"; flow: established, to_server; dsize: 130<>240; content: !"|1603|"; depth: 2; stream_size: server, =, 1;  stream_size: server, =, 1; stream_size: client, >,130; stream_size: client, <,300; flowbits: set, FBMproto_0; flowbits: noalert; pcre: "/[\x09-\x0e]/"; reference: url, github.com/ptresearch/AttackDetection; metadata: autosign, id_0,;  metadata: created_at 2019_02_19, updated_at 2021_03_20; classtype: misc-activity; sid: 11004534; rev: 4;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "APP [PTsecurity] MTproto Telegram pkt chk#1"; flow: established, to_client; dsize: 100<>120; stream_size: server, >,100; stream_size: server, <,200; stream_size: client, >,130; stream_size: client, <,300; flowbits: isset, FBMproto_0; flowbits: unset, FBMproto_0; flowbits: set, FBMproto_1; flowbits: noalert; pcre: "/[\x09-\x0e]/"; reference: url, github.com/ptresearch/AttackDetection; metadata: autosign, id_0,;  metadata: created_at 2019_02_19, updated_at 2021_03_20; classtype: misc-activity; sid: 11004535; rev: 3;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "APP [PTsecurity] MTproto Telegram pkt chk#2"; flow: established, to_server; dsize: 130<>450; stream_size: server, >,100; stream_size: server, <,200; stream_size: client, >,260; stream_size: client, <,880; flowbits: isset, FBMproto_1; flowbits: unset, FBMproto_1; flowbits: set, FBMproto_2; flowbits: noalert; pcre: "/[\x09-\x0e]/"; reference: url, github.com/ptresearch/AttackDetection; metadata: autosign, id_0,;  metadata: created_at 2019_02_19, updated_at 2021_03_20; classtype: misc-activity; sid: 11004536; rev: 3;)

alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg: "APP [PTsecurity] MTproto Telegram pkt chk#3"; flow: established, to_client; dsize: 150<>250; stream_size: server, >,250; stream_size: server, <,600; stream_size: client, >,260; stream_size: client, <,880; flowbits: isset, FBMproto_2; flowbits: unset, FBMproto_2; flowbits: set, FBMproto_3; flowbits: noalert; pcre: "/[\x09-\x0e]/"; reference: url, github.com/ptresearch/AttackDetection; metadata: autosign, id_0,;  metadata: created_at 2019_02_19, updated_at 2021_03_20; classtype: misc-activity; sid: 11004537; rev: 3;)

alert tcp $HOME_NET any -> $EXTERNAL_NET any (msg: "APP [PTsecurity] MTproto Telegram"; flow: established, to_server; dsize: 250<>350;stream_size: server, >,250;stream_size: server, <,600;stream_size: client, >,460;stream_size: client, <,1000;flowbits: isset, FBMproto_3;flowbits: unset, FBMproto_3; pcre: "/[\x09-\x0e]/"; reference: url, github.com/ptresearch/AttackDetection; metadata: autosign, id_0,; metadata: created_at 2019_02_19, updated_at 2019_07_25; classtype: misc-activity; sid: 11004538; rev: 2;)

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection #0"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,270, 1, relative; byte_test: 2, <=,292, 1, relative; stream_size: server, <,2710; stream_size: client, <,1540; flowbits: noalert; flowbits: set, FB314917_0; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11101465; rev: 2;) 

#alert tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection #1"; flow: established, to_client; content: "|1703|"; depth:2; byte_test: 2, >=,400, 1, relative; byte_test: 2, <=,416, 1, relative; stream_size: server, <,2710; stream_size: client, <,1540;  flowbits: isset, FB314917_0; flowbits: unset, FB314917_0; flowbits: set, FB314917_1;  flowbits: noalert; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11101466; rev: 2;) 

#alert tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Dyre/Trickbot/Dridex SSL connection #2"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,400, 1, relative;  byte_test: 2, <=,416, 1, relative; stream_size: server, <,3300; stream_size: client, <,2500;  flowbits: isset, FB314917_1; flowbits: unset, FB314917_1; flowbits: set, FB314917_2; classtype: trojan-activity; metadata: created_at 2017_8_3; reference: url, github.com/ptresearch/AttackDetection; sid: 11101467; rev: 1;) 

#alert  tls $EXTERNAL_NET any -> $HOME_NET any ( msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu Certificate flowbit set 1"; flow: established, to_client;content: "|3082|";depth:300; content: "|3082|";distance:2;within:2; content: "|a00302010202|";distance:2;within:6; flowbits: set, FB332502_; flowbits: noalert; threshold: type limit, track by_src, count 1, seconds 30;  metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11124751; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

#alert  tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 2"; flow: established, to_server; content: "|1703|"; depth:2; content: "|0040|"; distance:1; within:2; fast_pattern; stream_size: server, >,1689; stream_size: server, <,2124; stream_size: client, >,447; stream_size: client, <,1722; flowbits: isset, FB332502_; flowbits: set, FB332502_0; flowbits: noalert;  metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11124752; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

#alert  tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 3";flow: established, to_client;content: "|1703|"; depth:2;content: "|0040|"; distance:1; within:2; fast_pattern;stream_size: server, >,1658;stream_size: server, <,2124;stream_size: client, >,447;stream_size: client, <,4222;flowbits: isset, FB332502_0;flowbits: unset, FB332502_0;flowbits: set, FB332502_1; flowbits: noalert; metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1;classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11124753; rev:4;metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

#alert  tls $HOME_NET any -> $EXTERNAL_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 4"; flow: established, to_server; content: "|1703|"; depth:2; byte_test: 2, >=,900, 1, relative; byte_test: 2, <=,1100, 1, relative; stream_size: server,  >,1758; stream_size: server, <,2124; stream_size: client, >,1376; stream_size: client, <,5922; flowbits: isset, FB332502_1; flowbits: unset, FB332502_1; flowbits: set, FB332502_2; flowbits: noalert;  metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11124754; rev:3; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_01_30;)

#alert  tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu pkt Checker flowbit set 5"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0050|"; distance:1; within:2; fast_pattern; stream_size: server, >,1843; stream_size: server, <,2924; stream_size: client, >,1476; stream_size: client, <,8722; flowbits: isset, FB332502_2; flowbits: unset, FB332502_2; flowbits: set, FB332502_3; flowbits: noalert; metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11124755; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_02_14;)

#alert  tls $EXTERNAL_NET any -> $HOME_NET any (msg: "MALWARE [PTsecurity] Backdoor.Java.Adwind.cu"; flow: established, to_client; content: "|1703|"; depth:2; content: "|0050|"; distance:1; within:2; fast_pattern; stream_size: server, >,1843; stream_size: server, <,3036; stream_size: client, >,1476; stream_size: client, <,8834; flowbits: isset, FB332502_3; flowbits: unset, FB332502_3; threshold: type limit, track by_src, count 1, seconds 30; metadata: former_category TROJAN; reference:md5,56e42156a1676b34f5350c01e34875d1; classtype:trojan-activity; reference: url, github.com/ptresearch/AttackDetection; sid: 11124756; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Major, created_at 2017_09_21, malware_family Adwind, performance_impact Moderate, updated_at 2018_02_14;)

